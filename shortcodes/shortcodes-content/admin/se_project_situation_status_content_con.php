<html lang="en" data-textdirection="rtl" class="loading">

<!-- Mirrored from pixinvent.com/free-bootstrap-template/robust-lite/html/rtl/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 28 Jun 2017 06:37:27 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Robust admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, robust admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>وب سایت من</title>
    <link rel="apple-touch-icon" sizes="60x60" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-60.png'); ?>">
    <link rel="apple-touch-icon" sizes="76x76" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-76.png'); ?>">
    <link rel="apple-touch-icon" sizes="120x120" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-120.png'); ?>">
    <link rel="apple-touch-icon" sizes="152x152" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-152.png'); ?>">

    <link rel="shortcut icon" type="image/x-icon" href="https://pixinvent.com/free-bootstrap-template/robust-lite/app-assets/images/ico/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="<?php echo plugins_url('emp/assets-profile/images/ico/favicon-32.png'); ?>">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!-- BEGIN VENDOR CSS-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/bootstrap.css'); ?>">
    <!-- font icons-->

    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/fonts/icomoon.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/fonts/flag-icon-css/css/flag-icon.min.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/vendors/css/extensions/pace.css'); ?>">
    <!-- END VENDOR CSS-->
    <!-- BEGIN ROBUST CSS-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/bootstrap-extended.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/app.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/colors.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/custom-rtl.css'); ?>">
    <!-- END ROBUST CSS-->
    <!-- BEGIN Page Level CSS-->

    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/core/menu/menu-types/vertical-menu.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/core/menu/menu-types/vertical-overlay-menu.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/pages/login-register.css'); ?>">

    <!-- END Page Level CSS-->
    <!-- BEGIN Custom CSS-->
<!--        <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css/style-rtl.css'); ?><!--">-->
    <!-- END Custom CSS-->

    <!-- BEGIN Custom font-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets/css/login-style.css'); ?>">
    <!-- END Custom Font-->



    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/mdb/mdb.min.css'); ?>">
<!--        <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css-rtl/mdb/jquery.dataTables.min.css'); ?><!--">-->
<!--        <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css-rtl/mdb/buttons.dataTables.min.css'); ?><!--">-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/persian-date/persian-datepicker.min.css'); ?>">


    <style type="text/css">


        [data-notify="progressbar"] {
            margin-bottom: 0px;
            position: absolute;
            bottom: 0px;
            left: 0px;
            width: 100%;
            height: 5px;
        }
        [data-notify="dismiss"] {
            float: left;
        }

        @media screen and (min-width: 640px) {
            .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
                text-align: left;
            }
        }
        .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
            margin: 10px;
        }
        .custom-select{
            font-family: IRANSansWeb;
        }

        .popover{
            left: 0;
            right: auto;
            font-family: IRANSansWeb;
        }

        .popover-content {
            display: none;
        }
        .btn-floating{
            margin: 0px;
        }
        .datepicker-plot-area{
            font-family: IRANSansWeb;
        }
        .trigger {
            padding: 1px 10px;
            font-size: 12px;
            font-weight: 400;
            border-radius: 10px;
            background-color: #eee;
            color: #212121;
            display: inline-block;
            margin: 2px 5px;
        }

        .hoverable, .trigger {
            transition: box-shadow 0.55s;
            box-shadow: 0;
        }

        .hoverable:hover, .trigger:hover {
            transition: box-shadow 0.45s;
            box-shadow: 0 8px 17px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

        td{
            direction: ltr;
            text-align: center;
            font-family: IRANSansWeb !important;
        }

        div.dt-buttons{
            float: right;
        }
        button.dt-button, div.dt-button, a.dt-button{
            border-radius: 40px;
        }

        .dataTables_info{
            float: left;
            padding: 20px;
        }
        /*.table th, .table td{*/
            /*vertical-align: middle;*/
        /*}*/
        table.table a {color: #3b0ff3;}
    </style>

</head>
<body data-open="click" data-menu="vertical-menu" data-col="2-columns" class="vertical-layout vertical-menu 2-columns  fixed-navbar">
<!-- navbar-fixed-top-->

<?php require_once( plugin_dir_path(__FILE__) . 'header/header.php' ); ?>

<!-- ////////////////////////////////////////////////////////////////////////////-->


<!-- main menu-->
<div data-scroll-to-active="true" class="main-menu menu-fixed menu-dark menu-accordion menu-shadow">
    <!-- main menu header-->
    <div class="main-menu-header">
        <!--            <input type="text" placeholder="Search" class="menu-search form-control round"/>-->
    </div>
    <!-- / main menu header-->
    <!-- main menu content-->
    <?php require_once( plugin_dir_path(__FILE__) . 'sidebar/sidebar-menu.php' ); ?>
    <!-- /main menu content-->
    <!-- main menu footer-->
    <!-- include includes/menu-footer-->
    <!-- main menu footer-->
</div>
<!-- / main menu-->

<div class="app-content content container-fluid">
    <div class="content-wrapper">

        <div class="content-body">

            <?php
            require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
            global $wpdb;
            if (isset($_GET['p_id'],$_GET['pss_id']))
            {
                $p_id=intval($_GET['p_id']);
                $pss_id=intval($_GET['pss_id']);

                $table = $wpdb->prefix .'psituation_status';
                $query1 = "SELECT * FROM {$table}";
                $results1=$wpdb->get_results($query1);

                $table = $wpdb->prefix .'psituation_status';
                $query = "SELECT * FROM {$table} WHERE num={$pss_id} AND pid={$p_id}";
                $results=$wpdb->get_results($query);

                if (count($results1)!=0)
                {
                    if (count($results)==0)
                    {
                        wp_redirect(home_url().'/se_panel');
                    }
                }

                if (count($results1)==0)
                {
                    wp_redirect(home_url().'/se_panel');

                }

            }
            else
            {
                wp_redirect(home_url().'/se_panel');
            }

            ?>

            <div class="row">
                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php
                        $table = $wpdb->prefix .'projects';
                        $query = "SELECT * FROM {$table} WHERE id={$p_id}";
                        $result=$wpdb->get_row($query);
                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media">
                                    <div class="media-body text-xs-center">
                                        <span>پروژه : <?php echo $result->pname.'  ';?></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php
                    $table = $wpdb->prefix .'psituation_status';
                    $query = "SELECT * FROM {$table} WHERE num={$pss_id}";
                    $result=$wpdb->get_row($query);
                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media">
                                    <div class="media-body text-xs-center">
                                        <span>صورت وضعیت شماره  <?php echo $result->num.'  ';?></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php

                    $table = $wpdb->prefix .'psituation_status_con';
                    $query = "SELECT sum(r_total) as pss_total FROM {$table} WHERE pss_id<={$pss_id} AND  p_id={$p_id} ";
                    $result_total=$wpdb->get_results($query);

                    $table = $wpdb->prefix .'projects';
                    $query = "SELECT * FROM {$table} WHERE id={$p_id}";
                    $result=$wpdb->get_row($query);

                    $pss_cprofit=($result_total[0]->pss_total)*($result->cprofit/100);
                    $pss_total=$result_total[0]->pss_total + $pss_cprofit;
                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media">
                                    <div class="media-body text-xs-center">
                                        <span>سود پیمانکار : <b id="pss_cprofit"><?php echo $pss_cprofit .'  ';?></b></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php

                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media ">
                                    <div class="media-body text-xs-center">
                                        <span >جمع کل : <b id="pss_con_total"><?php echo $pss_total.'  ';?></b></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <p>
                <span class="float-xs-right">
                    <a type="button" class="btn purple-gradient btn-rounded white mr-1 mb-1 waves-effect waves-light" href="<?php echo home_url('se_project_situation_status/?p_id='.$p_id);?>">
                        بازگشت به لیست صورت وضعیت ها
                        <i class="icon-arrow-left4 fa-lg"></i>
                    </a>
                </span>
            </p>
            <div class="row">
                <div class="col-xs-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title"> صورت وضعیت شماره<?php echo $pss_id?></h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                        <table id="pss_con_tbl" class="table table-hover table-bordered  table-sm mb-0">
                                            <thead class="thead-default">
                                            <tr>
                                                <th rowspan="2">#</th>
                                                <th rowspan="2">عملیات</th>
                                                <th rowspan="2">شرح عملیات</th>
                                                <th rowspan="2">تعداد</th>
                                                <th colspan="2">سطح - حجم - وزن</th>
                                                <th rowspan="2">واحد</th>
                                                <th rowspan="2">بهای واحد</th>
                                                <th rowspan="2">بهای کل</th>
                                                <th rowspan="2">توضیحات</th>
                                            </tr>
                                            <tr>
                                                <th>جزئی</th>
                                                <th>جمع کل</th>
                                            </tr>

                                            </thead>
                                        </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade text-xs-left" id="add_supervisor_form" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <label class="modal-title text-text-bold-600" id="myModalLabel33">افزودن سطر</label>
                        </div>


                        <div class="card-block">
                            <form class="form" method="post" action="">
                                <div class="form-body">
                                    <div class="row">
                                        <div class="col-sm-9">
                                            <div class="form-group">
                                                <label for="pss_add_con_title">شرح عملیات</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="text" id="pss_add_con_title" class="form-control text-xs-left" name="pss_add_con_title" style="direction: ltr;">
                                                    <div class="form-control-position">
                                                        <i class="icon-android-clipboard"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label for="pss_add_con_count">تعداد</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="number" id="pss_add_con_count" class="form-control text-xs-center" name="pss_add_con_count" min="1">
                                                    <div class="form-control-position">
                                                        <i class="icon-sort-numeric-asc2"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label for="pss_add_con_vol_area_weight_minor">سطح - حجم - وزن (جزئی)</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="number" id="pss_add_con_vol_area_weight_minor" class="form-control text-xs-center" name="pss_add_con_vol_area_weight_minor" min="1">
                                                    <div class="form-control-position">
                                                        <i class="icon-stack-overflow"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label for="pss_add_con_unit">واحد</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="text" id="pss_add_con_unit" class="form-control text-xs-center" name="pss_add_con_unit" style="direction: ltr;">
                                                    <div class="form-control-position">
                                                        <i class="icon-equalizer"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label for="pss_add_con_unit_price">بهای واحد</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="number" id="pss_add_con_unit_price" class="form-control text-xs-center" name="pss_add_con_unit_price" min="1">
                                                    <div class="form-control-position">
                                                        <i class="icon-dollar"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label for="pss_add_con_description">توضیحات</label>
                                                <div class="position-relative has-icon-left">
                                                    <textarea id="pss_add_con_description"  rows="5" class="form-control text-xs-left" name="pss_add_con_description"></textarea>
                                                    <div class="form-control-position">
                                                        <i class="icon-document"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-actions right">
                                    <button type="reset" class="btn btn-warning mr-1" data-dismiss="modal" value="close">
                                        <i class="icon-cross2"></i> انصراف
                                    </button>
                                    <button type="button" class="btn btn-primary" name="pss_add_con_submit" id="pss_add_con_submit">
                                        <i class="icon-check2"></i> افزودن
                                    </button>
                                </div>
                            </form>

                        </div>


                    </div>
                </div>
            </div>

            <div class="modal fade text-xs-left" id="edit_psituation_status_con_form" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <label class="modal-title text-text-bold-600" id="myModalLabel33">ویرایش سطر</label>
                        </div>


                        <div class="card-block">
                            <form class="form" method="post" action="">
                                <div class="form-body">
                                    <div class="row">
                                        <div class="col-sm-9">
                                            <div class="form-group">
                                                <label for="pss_edit_con_title">شرح عملیات</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="text" id="pss_edit_con_title" class="form-control text-xs-left" name="pss_edit_con_title" style="direction: ltr;">
                                                    <div class="form-control-position">
                                                        <i class="icon-android-clipboard"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label for="pss_edit_con_count">تعداد</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="number" id="pss_edit_con_count" class="form-control text-xs-center" name="pss_edit_con_count" min="1">
                                                    <div class="form-control-position">
                                                        <i class="icon-sort-numeric-asc2"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label for="pss_edit_con_vol_area_weight_minor">سطح - حجم - وزن (جزئی)</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="number" id="pss_edit_con_vol_area_weight_minor" class="form-control text-xs-center" name="pss_edit_con_vol_area_weight_minor" min="1">
                                                    <div class="form-control-position">
                                                        <i class="icon-stack-overflow"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label for="pss_edit_con_unit">واحد</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="text" id="pss_edit_con_unit" class="form-control text-xs-center" name="pss_edit_con_unit" style="direction: ltr;">
                                                    <div class="form-control-position">
                                                        <i class="icon-equalizer"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label for="pss_edit_con_unit_price">بهای واحد</label>
                                                <div class="position-relative has-icon-left">
                                                    <input type="number" id="pss_edit_con_unit_price" class="form-control text-xs-center" name="pss_edit_con_unit_price" min="1">
                                                    <div class="form-control-position">
                                                        <i class="icon-dollar"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label for="pss_edit_con_description">توضیحات</label>
                                                <div class="position-relative has-icon-left">
                                                    <textarea id="pss_edit_con_description"  rows="5" class="form-control text-xs-left" name="pss_edit_con_description"></textarea>
                                                    <div class="form-control-position">
                                                        <i class="icon-document"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-actions right">
                                        <button type="reset" class="btn btn-warning mr-1" data-dismiss="modal" value="close">
                                            <i class="icon-cross2"></i> انصراف
                                        </button>
                                        <button type="button" class="btn btn-primary" name="pss_edit_con_submit" id="pss_edit_con_submit">
                                            <i class="icon-check2"></i> ویرایش
                                        </button>
                                        <input type="hidden" id="pss_edit_con_id" name="pss_edit_id">
                                    </div>
                            </form>






                        </div>


                    </div>
                </div>
            </div>




        </div>
    </div>
</div>


<?php //require_once( plugin_dir_path(__FILE__) . 'footer/footer.php' ); ?>


<!-- BEGIN VENDOR JS-->
<script src="<?php echo plugins_url('emp/assets-profile/js/core/libraries/jquery.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/tether.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/core/libraries/bootstrap.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/perfect-scrollbar.jquery.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/unison.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/blockUI.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/jquery.matchHeight-min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/screenfull.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/extensions/pace.min.js'); ?>" type="text/javascript"></script>
<!-- BEGIN PAGE VENDOR JS-->
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/charts/chart.min.js'); ?>" type="text/javascript"></script>
<!-- END PAGE VENDOR JS-->
<!-- BEGIN ROBUST JS-->
<script src="<?php echo plugins_url('emp/assets-profile/js/core/app-menu.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/core/app.js'); ?>" type="text/javascript"></script>
<!-- END ROBUST JS-->
<!-- BEGIN PAGE LEVEL JS-->
<!--<script src="--><?php //echo plugins_url('emp/assets-profile/js/scripts/pages/dashboard-lite.js'); ?><!--" type="text/javascript"></script>-->

<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/mdb.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/popper.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/datatables.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/dataTables.buttons.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.flash.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/jszip.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/pdfmake.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/vfs_fonts.js'); ?>" type="text/javascript"></script>

<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.html5.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.print.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/persian.js'); ?>" type="text/javascript"></script>


<script src="<?php echo plugins_url('emp/assets-profile/js/persian-date/persian-date.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/persian-date/persian-datepicker.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/digitSeprator/autonumbric.min.js'); ?>" type="text/javascript"></script>

<!-- start bootstrap notify master-->
<script src="<?php echo plugins_url('emp/assets-profile/js/bootstrap-notify-master/bootstrap-notify.min.js'); ?>" type="text/javascript"></script>
<!-- end  bootstrap notify master-->

<script type="text/javascript">
    // Basic example
    $(document).ready(function () {

        fetch_data();
        function fetch_data()
        {
            var dataTable = $('#pss_con_tbl').DataTable
            (
                {
                    "aoColumns": [
                        { "sClass": "text-xs-center align-middle" },
                        {"sWidth": "30%" , "sClass": "text-xs-center align-middle" },
                        {"sWidth": "20%" , "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                    ],
                    "pagingType": "full_numbers",
                    // "paging": false,
                    "tabIndex": 1,
                    "pageLength":10,
                    "dom": "Bfrtip",
                    "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
                    buttons: [
                        {
                            text: '<i class="icon-plus3 fa-lg "></i> &nbsp;افزودن سطر جدید',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'add_row'
                            }
                        }
                        ,
                        {
                            text: '<i class="icon-printer4 fa-lg"></i> &nbsp;پرینت صورت وضعیت',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'print_pss'
                            }
                        }
                    ],
                    "searching": true,
                    "bAutoWidth": false,
                    // "filter": false,
                    "language": {
                        "processing": "در حال پردازش اطلاعات ...",
                        "sInfo":"نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                        "emptyTable": "رکوردی یافت نشد",
                        "lengthMenu": "",
                        "zeroRecords": "",
                        "info": "",
                        "infoEmpty": "",
                        "infoFiltered": "",
                        "search": "_INPUT_",
                        "searchPlaceholder": "جستجو...",
                        "paginate": {
                            "previous": "بعدی",
                            "next": "قبلی",
                            "last" : "»",
                            "first" : "«"
                        }

                    },
                     "processing": false,
                    "serverSide": true,
                    "ajax": {
                        "url" : "<?php echo admin_url('admin-ajax.php?action=psituation_status_con_data&pss_id=' . $pss_id.'&p_id='.$p_id)?>",
                    },
                    "fnDrawCallback" : function() {
                        traverse(document.body);
                    }
                }
            );


            persian={0:'۰',1:'۱',2:'۲',3:'۳',4:'۴',5:'۵',6:'۶',7:'۷',8:'۸',9:'۹'};
            function traverse(el){
                if(el.nodeType==3){
                    var list=el.data.match(/[0-9]/g);
                    if(list!=null && list.length!=0){
                        for(var i=0;i<list.length;i++)
                            el.data=el.data.replace(list[i],persian[list[i]]);
                    }
                }
                for(var i=0;i<el.childNodes.length;i++){
                    traverse(el.childNodes[i]);
                }
            }
        }



        $('#pss_con_tbl tbody').on('click',"#se_pss_con_edit", function(){
            var pss_edit_con_id = $(this).data("id");
            var pss_edit_con_title = $(this).data("title");
            var pss_edit_con_count = $(this).data("count");
            var pss_edit_con_vol_area_weight_minor = $(this).data("vol_area_weight_minor");
            var pss_edit_con_unit = $(this).data("unit");
            var pss_edit_con_unit_price = $(this).data("unit-price");
            var pss_edit_con_description = $(this).data("description");

            $('#pss_edit_con_id').val(pss_edit_con_id);
            $('#pss_edit_con_title').val(pss_edit_con_title);
            $('#pss_edit_con_count').val(pss_edit_con_count);
            $('#pss_edit_con_vol_area_weight_minor').val(pss_edit_con_vol_area_weight_minor);
            $('#pss_edit_con_unit').val(pss_edit_con_unit);
            $('#pss_edit_con_unit_price').val(pss_edit_con_unit_price);
            $('#pss_edit_con_description').val(pss_edit_con_description);
            $('#edit_psituation_status_con_form').modal('toggle');
        });


        $('body').on('click',"#pss_edit_con_submit", function(){
            var pss_edit_con_id=$('#pss_edit_con_id').val();
            var pss_edit_con_title=$('#pss_edit_con_title').val();
            var pss_edit_con_count=$('#pss_edit_con_count').val();
            var pss_edit_con_vol_area_weight_minor=$('#pss_edit_con_vol_area_weight_minor').val();
            var pss_edit_con_unit=$('#pss_edit_con_unit').val();
            var pss_edit_con_unit_price=$('#pss_edit_con_unit_price').val();
            var pss_edit_con_description=$('#pss_edit_con_description').val();

            if( pss_edit_con_title != '' && pss_edit_con_id != '' && pss_edit_con_count != '' && pss_edit_con_vol_area_weight_minor != '' && pss_edit_con_unit != '' && pss_edit_con_unit_price != '' )
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pss_con_update&p_id=' . $p_id)?>",
                    data:{
                        pss_edit_id:<?php echo $pss_id;?>,
                        pss_edit_con_id:pss_edit_con_id,
                        pss_edit_con_title:pss_edit_con_title,
                        pss_edit_con_count:pss_edit_con_count,
                        pss_edit_con_vol_area_weight_minor:pss_edit_con_vol_area_weight_minor,
                        pss_edit_con_unit:pss_edit_con_unit,
                        pss_edit_con_unit_price:pss_edit_con_unit_price,
                        pss_edit_con_description:pss_edit_con_description
                    },
                    success:function(data)
                    {
                        $('#pss_con_total').html(data[1]);
                        $('#pss_cprofit').html(data[2]);
                        $('#edit_psituation_status_con_form').modal('hide');
                        $.notify(
                            {
                                message: data[0]
                            },
                            {
                                z_index: 999999999,
                                type: 'success',
                                placement: {
                                    from: "top",
                                    align: "left"
                                },
                                showProgressbar : true,
                                mouse_over: "pause",
                                allow_dismiss : false
                            }
                        );
                        $('#pss_con_tbl').DataTable().destroy();
                        fetch_data();

                    }
                });
            }
            else
            {
                $.notify(
                    {
                        message: 'تمامی فیلد ها را وارد نمایید!(فیلد توضیحات اختیاری است)'
                    },
                    {
                        z_index: 999999999,
                        type: 'danger',
                        placement: {
                            from: "top",
                            align: "left"
                        },
                        showProgressbar : true,
                        mouse_over: "pause",
                        allow_dismiss : false
                    }
                );

            }
        });



        $(document).on('click', '#se_pss_con_delete', function(){
            var id = $(this).data("id");
            if(confirm("مطمئن هستید?"))
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pss_con_delete')?>",
                    data:{
                        id:id,
                        p_id:<?php echo $p_id;?>,
                        pss_id:<?php echo $pss_id;?>,
                    },
                    success:function(data){
                        $('#pss_con_total').html(data[1]);
                        $('#pss_cprofit').html(data[2]);
                        $.notify(
                            {
                                message: data[0]
                            },
                            {
                                type: 'success',
                                placement: {
                                    from: "top",
                                    align: "left"
                                },
                                showProgressbar : true,
                                mouse_over: "pause",
                                allow_dismiss : false
                            }
                        );
                        $('#pss_con_tbl').DataTable().destroy();
                        fetch_data();
                    }
                });
            }
        });

        $(document).on('click', '#add_row', function(){
            $('#pss_add_con_title').val('');
            $('#pss_add_con_count').val('');
            $('#pss_add_con_vol_area_weight_minor').val('');
            $('#pss_add_con_unit').val('');
            $('#pss_add_con_unit_price').val('');
            $('#pss_add_con_description').val('');
            $('#add_supervisor_form').modal('toggle');
        });


        $('body').on('click',"#se_pss_con_cancel", function(){
            $(this).closest("tr").remove();
        });


        $(document).on('click', '#pss_add_con_submit', function(){
            var pss_add_con_title = $('#pss_add_con_title').val();
            var pss_add_con_count = $('#pss_add_con_count').val();
            var pss_add_con_vol_area_weight_minor = $('#pss_add_con_vol_area_weight_minor').val();
            var pss_add_con_unit = $('#pss_add_con_unit').val();
            var pss_add_con_unit_price = $('#pss_add_con_unit_price').val();
            var pss_add_con_description = $('#pss_add_con_description').val();

            if( pss_add_con_title != '' && pss_add_con_count != '' && pss_add_con_vol_area_weight_minor != '' && pss_add_con_unit != '' && pss_add_con_unit_price != '')
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pss_add_con')?>",
                    data:{
                        pss_add_con_p_id:<?php echo $p_id;?>,
                        pss_add_con_pss_id:<?php echo $pss_id;?>,
                        pss_add_con_title:pss_add_con_title,
                        pss_add_con_count:pss_add_con_count,
                        pss_add_con_vol_area_weight_minor:pss_add_con_vol_area_weight_minor,
                        pss_add_con_unit:pss_add_con_unit,
                        pss_add_con_unit_price:pss_add_con_unit_price,
                        pss_add_con_description:pss_add_con_description
                    },
                    success:function(data)
                    {

                        if(data[3]==true)
                        {
                            $('#pss_con_total').html(data[1]);
                            $('#pss_cprofit').html(data[2]);
                            $('#add_supervisor_form').modal('hide');
                            $.notify(
                                {
                                    message: data[0]
                                },
                                {
                                    z_index: 999999999,
                                    type: 'success',
                                    placement: {
                                        from: "top",
                                        align: "left"
                                    },
                                    showProgressbar : true,
                                    mouse_over: "pause",
                                    allow_dismiss : false
                                }
                            );
                            $('#pss_con_tbl').DataTable().destroy();
                            fetch_data();
                        }
                        else
                        {
                            $.notify(
                                {
                                    message: data[0]
                                },
                                {
                                    z_index: 999999999,
                                    type: 'danger',
                                    placement: {
                                        from: "top",
                                        align: "left"
                                    },
                                    showProgressbar : true,
                                    mouse_over: "pause",
                                    allow_dismiss : false
                                }
                            );
                        }

                    }
                });
            }
            else
            {
                $.notify(
                    {
                        message: "تمامی فیلد ها را وارد نمایید!(توضیحات اختیاری است)"
                    },
                    {
                        z_index: 999999999,
                        type: 'danger',
                        placement: {
                            from: "top",
                            align: "left"
                        },
                        showProgressbar : true,
                        mouse_over: "pause",
                        allow_dismiss : false
                    }
                );
            }
        });


        $(document).on('click', '#print_pss', function(){
            window.open(
                '<?php echo home_url('se_admin_print/?p_id='.$p_id.'&target_tbl=pss_con&pss_id='.$pss_id)?>',
                '_blank' // <- This is what makes it open in a new window.
            );
        });

    });





</script>
<!-- END PAGE LEVEL JS-->

</body>

</html>

