<html lang="en" data-textdirection="rtl" class="loading">

<!-- Mirrored from pixinvent.com/free-bootstrap-template/robust-lite/html/rtl/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 28 Jun 2017 06:37:27 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Robust admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, robust admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title><?php get_the_title()?></title>
    <link rel="apple-touch-icon" sizes="60x60" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-60.png'); ?>">
    <link rel="apple-touch-icon" sizes="76x76" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-76.png'); ?>">
    <link rel="apple-touch-icon" sizes="120x120" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-120.png'); ?>">
    <link rel="apple-touch-icon" sizes="152x152" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-152.png'); ?>">

    <link rel="shortcut icon" type="image/x-icon" href="https://pixinvent.com/free-bootstrap-template/robust-lite/app-assets/images/ico/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="<?php echo plugins_url('emp/assets-profile/images/ico/favicon-32.png'); ?>">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!-- BEGIN VENDOR CSS-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/bootstrap.css'); ?>">
    <!-- font icons-->

    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/fonts/icomoon.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/fonts/flag-icon-css/css/flag-icon.min.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/vendors/css/extensions/pace.css'); ?>">
    <!-- END VENDOR CSS-->
    <!-- BEGIN ROBUST CSS-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/bootstrap-extended.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/app.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/colors.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/custom-rtl.css'); ?>">
    <!-- END ROBUST CSS-->
    <!-- BEGIN Page Level CSS-->

    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/core/menu/menu-types/vertical-menu.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/core/menu/menu-types/vertical-overlay-menu.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/pages/login-register.css'); ?>">

    <!-- END Page Level CSS-->
    <!-- BEGIN Custom CSS-->
    <!--        <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css/style-rtl.css'); ?><!--">-->
    <!-- END Custom CSS-->

    <!-- BEGIN Custom font-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets/css/login-style.css'); ?>">
    <!-- END Custom Font-->



    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/mdb/mdb.min.css'); ?>">
    <!--        <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css-rtl/mdb/jquery.dataTables.min.css'); ?><!--">-->
    <!--        <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css-rtl/mdb/buttons.dataTables.min.css'); ?><!--">-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/persian-date/persian-datepicker.min.css'); ?>">


    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/time-picker/mdTimePicker.css'); ?>">

    <script src="<?php echo plugins_url('emp/assets-profile/js/core/libraries/jquery.min.js'); ?>" type="text/javascript"></script>

    <script src="<?php echo plugins_url('emp/assets-profile/js/persian-date/persian-date.min.js'); ?>" type="text/javascript"></script>
    <script src="<?php echo plugins_url('emp/assets-profile/js/persian-date/persian-datepicker.min.js'); ?>" type="text/javascript"></script>

    <style type="text/css">
        @media screen and (min-width: 640px) {
            .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
                text-align: left;
            }
        }
        .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
            margin: 10px;
        }
        .custom-select{
            font-family: IRANSansWeb;
        }

        .popover{
            left: 0;
            right: auto;
            font-family: IRANSansWeb;
        }

        .popover-content {
            display: none;
        }
        .btn-floating{
            margin: 0px;
        }
        .datepicker-plot-area{
            font-family: IRANSansWeb;
        }
        .trigger {
            padding: 1px 10px;
            font-size: 12px;
            font-weight: 400;
            border-radius: 10px;
            background-color: #eee;
            color: #212121;
            display: inline-block;
            margin: 2px 5px;
        }

        .hoverable, .trigger {
            transition: box-shadow 0.55s;
            /*box-shadow: 0px;*/
        }

        .hoverable:hover, .trigger:hover {
            transition: box-shadow 0.45s;
            box-shadow: 0 8px 17px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

        td{
            direction: ltr;
            text-align: center;
            font-family: IRANSansWeb !important;
        }

        div.dt-buttons{
            float: right;
        }
        button.dt-button, div.dt-button, a.dt-button{
            border-radius: 40px;
        }

        .dataTables_info{
            float: left;
            padding: 20px;
        }
        .table th, .table td{
            vertical-align: middle;
        }
        #pdr_date_insert2 , #pdr_max_temp_insert,#pdr_min_temp_insert{
            text-align: center;
        }
    </style>

</head>
<body data-open="click" data-menu="vertical-menu" data-col="2-columns" class="vertical-layout vertical-menu 2-columns  fixed-navbar">
<!-- navbar-fixed-top-->

<?php require_once( plugin_dir_path(__FILE__) . 'header/header.php' ); ?>

<!-- ////////////////////////////////////////////////////////////////////////////-->


<!-- main menu-->
<div data-scroll-to-active="true" class="main-menu menu-fixed menu-dark menu-accordion menu-shadow">
    <!-- main menu header-->
    <div class="main-menu-header">
        <!--            <input type="text" placeholder="Search" class="menu-search form-control round"/>-->
    </div>
    <!-- / main menu header-->
    <!-- main menu content-->
    <?php require_once( plugin_dir_path(__FILE__) . 'sidebar/sidebar-menu.php' ); ?>
    <!-- /main menu content-->
    <!-- main menu footer-->
    <!-- include includes/menu-footer-->
    <!-- main menu footer-->
</div>
<!-- / main menu-->

<div class="app-content content container-fluid">
    <div class="content-wrapper">

        <div class="content-body">
            <?php
            if (isset($_GET['se_pdr_edit_submit']))
            {
                $p_id=intval($_GET['se_pid_edit']);
                $pdr_id=intval($_GET['se_pdr_id_edit']);

                $epoch2 = $_GET['se_pdr_date_edit'];
                $dt = new DateTime("@$epoch2");  // convert UNIX timestamp to PHP DateTime
                $pdr_date_edit=$dt->format('Y-m-d');

                $pdr_status_edit=sanitize_text_field($_GET['se_pdr_status_edit']);
                $pdr_min_temp_edit=intval($_GET['se_pdr_min_temp_edit']);
                $pdr_max_temp_edit=intval($_GET['se_pdr_max_temp_edit']);
                $pdr_important_work_edit=sanitize_text_field($_GET['se_pdr_important_work_edit']);
                $pdr_next_day_plan_edit=sanitize_text_field($_GET['se_pdr_next_day_plan_edit']);
                $pdr_problems_edit=sanitize_text_field($_GET['se_pdr_problems_edit']);

                require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
                global $wpdb;
                $table = $wpdb->prefix .'pdaily_reports';

                $query = "SELECT * FROM {$table} WHERE pid={$p_id} AND id={$pdr_id}";
                $results = $wpdb->get_results($query);

                if($wpdb->num_rows == 0)
                {
                    ?>
                    <script type="text/javascript">
                        $(document).ready(function ()
                        {
                            $('#alert_message1').html('<div class="alert alert-success">'+'اطلاعات پروژه و گزارش مطابقت ندارند!'+'</div>');
                            setInterval(function(){
                                $('#alert_message1').html('');
                            }, 5000);
                        });


                    </script>
                <?php
                }
                else
                {
                    if ($wpdb->update( $table, array( 'date' => $pdr_date_edit , 'max_temp' => $pdr_max_temp_edit,'min_temp' => $pdr_min_temp_edit , 'status' => $pdr_status_edit, 'important_works' => $pdr_important_work_edit, 'next_day_plan' => $pdr_next_day_plan_edit, 'problems' => $pdr_problems_edit ),array('id' => $pdr_id)) === false)
                    {
                        ?>
                        <script type="text/javascript">

                            $(document).ready(function ()
                            {
                                $('#alert_message1').html('<div class="alert alert-success"><?php echo $wpdb->last_error ?></div>');
                                setInterval(function(){
                                    $('#alert_message1').html('');
                                }, 5000);
                            });

                        </script>
                    <?php
                    }
                    else
                    {
                        ?>
                        <script type="text/javascript">

                            $(document).ready(function ()
                            {
                                $('#alert_message1').html('<div class="alert alert-success">'+'ایتم مدنظر شما با موفقیت ویرایش گردید!'+'</div>');
                                setInterval(function(){
                                    $('#alert_message1').html('');
                                }, 5000);
                            });
                        </script>
                        <?php
                    }
                }





                require_once( ABSPATH . 'wp-content/plugins/emp/inc/jdf.php' );
                $table = $wpdb->prefix .'pdaily_reports';
                $query = "SELECT * FROM {$table} WHERE pid={$p_id} AND id={$pdr_id}";
                $results = $wpdb->get_results($query);

                if($wpdb->num_rows == 0)
                {
                    wp_redirect(home_url().'/se_project_daily_reports/?p_id='.$p_id);
                }
                else
                {
                    foreach($results as $result)
                    {
                        $pdr_id=$result->id;
                        $p_id=$result->pid;
                        $pdr_date=jdate("Y / m / d", strtotime($result ->date));
                        $time = explode('-',$result ->date);

                        $pdr_date_unix=gmmktime(0,0,0,$time[1],$time[2],$time[0]);
                        $pdr_max_temp=$result->max_temp;
                        $pdr_min_temp=$result->min_temp;
                        $pdr_status=$result->status;
                        $pdr_important_work=$result->important_works;
                        $pdr_next_day_plan=$result->next_day_plan;
                        $pdr_problems=$result->problems;
                    }
                }

            }
            elseif (isset($_GET['p_id'],$_GET['pdr_id']))
            {
                $p_id=intval($_GET['p_id']);
                $pdr_id=intval($_GET['pdr_id']);
                require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
                global $wpdb;
                require_once( ABSPATH . 'wp-content/plugins/emp/inc/jdf.php' );
                $table = $wpdb->prefix .'pdaily_reports';
                $query = "SELECT * FROM {$table} WHERE pid={$p_id} AND id={$pdr_id}";
                $results = $wpdb->get_results($query);

                if($wpdb->num_rows == 0)
                {
                    wp_redirect(home_url().'/se_project_daily_reports/?p_id='.$p_id);
                }
                else
                {
                    foreach($results as $result)
                    {
                        $pdr_id=$result->id;
                        $p_id=$result->pid;
                        $pdr_date=jdate("Y / m / d", strtotime($result ->date));
                        $time=explode('-',$result->date);
                        $pdr_date_unix=gmmktime(0,0,0,$time[1],$time[2],$time[0]);
                        $pdr_max_temp=$result->max_temp;
                        $pdr_min_temp=$result->min_temp;
                        $pdr_status=$result->status;
                        $pdr_important_work=$result->important_works;
                        $pdr_next_day_plan=$result->next_day_plan;
                        $pdr_problems=$result->problems;
                    }
                }
            }
            else
            {
                wp_redirect(home_url().'/se_panel');
                exit();
            }

            ?>
            <p>
                <span class="float-xs-right">
                    <a type="button" class="btn purple-gradient btn-rounded white mr-1 mb-1 waves-effect waves-light" href="<?php echo home_url('se_admin_print/?p_id='.$p_id.'&pdr_id='.$pdr_id.'&target_tbl=pdaily_reports')?>" target="_blank">
                        پرینت گزارش روزانه
                        <i class="icon-printer4 fa-lg"></i>
                    </a>
                    <a type="button" class="btn purple-gradient btn-rounded white mr-1 mb-1 waves-effect waves-light" href="<?php echo home_url('se_project_daily_reports/?p_id='.$p_id)?>">
                        بازگشت به لیست گزارش ها
                        <i class="icon-arrow-left4 fa-lg"></i>
                    </a>
                </span>
            </p>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title" id="basic-layout-form">اطلاعات کلی گزارش</h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body collapse in">
                            <div class="card-block">
                                <div id="alert_message1"></div>
                                <form class="form" method="get">

                                    <div class="form-body">


                                        <div class="row">

                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="se_pdr_date_edit2">تاریخ</label>
                                                    <div class="position-relative has-icon-left">
                                                        <input type="text" id="se_pdr_date_edit2" class="form-control" name="se_pdr_date_edit2" style="direction: ltr;text-align: center" value="<?php echo $pdr_date;?>"  required>
                                                        <input type="hidden" id="se_pdr_date_edit" class="form-control" name="se_pdr_date_edit" required value="<?php echo $pdr_date_unix;?>">
                                                        <div class="form-control-position">
                                                            <i class="icon-calendar5"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>وضعیت</label>
                                                    <div class="input-group">
                                                        <label class="display-inline-block custom-control custom-radio ml-1">
                                                            <input type="radio" id="se_pdr_status_published_edit" name="se_pdr_status_edit"  class="custom-control-input" value="published" <?php checked($pdr_status,"published")?>>
                                                            <span class="custom-control-indicator"></span>
                                                            <span class="custom-control-description ml-0">منتشر شده</span>
                                                        </label>
                                                        <label class="display-inline-block custom-control custom-radio">
                                                            <input type="radio" id="se_pdr_status_pending_edit" name="se_pdr_status_edit" class="custom-control-input" value="pending" <?php checked($pdr_status,"pending")?>>
                                                            <span class="custom-control-indicator"></span>
                                                            <span class="custom-control-description ml-0">در حال بررسی</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="se_pdr_min_temp_edit">حداقل دما</label>
                                                    <div class="position-relative has-icon-left">
                                                        <input type="number" id="se_pdr_min_temp_edit" class="form-control"  name="se_pdr_min_temp_edit" value="<?php echo $pdr_min_temp;?>" required>
                                                        <div class="form-control-position">
                                                            <i class="icon-arrow50"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="se_pdr_max_temp_edit">حداکثر دما</label>
                                                    <div class="position-relative has-icon-left">
                                                        <input type="number" id="se_pdr_max_temp_edit" class="form-control"  name="se_pdr_max_temp_edit" value="<?php echo $pdr_max_temp;?>" required>
                                                        <div class="form-control-position">
                                                            <i class="icon-arrow49"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="se_pdr_important_work_edit">شرح اهم فعالیت های صورت گرفته</label>
                                                    <div class="position-relative has-icon-left">
                                                        <textarea id="se_pdr_important_work_edit" rows="5" class="form-control" name="se_pdr_important_work_edit" ><?php echo $pdr_important_work;?></textarea>
                                                        <div class="form-control-position">
                                                            <i class="icon-file2"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="se_pdr_next_day_plan_edit">برنامه روز آینده</label>
                                                    <div class="position-relative has-icon-left">
                                                        <textarea id="se_pdr_next_day_plan_edit" rows="5" class="form-control" name="se_pdr_next_day_plan_edit"><?php echo $pdr_next_day_plan;?></textarea>
                                                        <div class="form-control-position">
                                                            <i class="icon-file2"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="se_pdr_problems_edit">مشکلات و موانع</label>
                                                    <div class="position-relative has-icon-left">
                                                        <textarea id="se_pdr_problems_edit" rows="5" class="form-control" name="se_pdr_problems_edit" ><?php echo $pdr_problems;?></textarea>
                                                        <div class="form-control-position">
                                                            <i class="icon-file2"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>


                                    </div>

                                    <div class="form-actions right">
                                        <button type="submit" class="btn btn-primary" name="se_pdr_edit_submit" id="se_pdr_edit_submit">
                                            <i class="icon-check2"></i> ویرایش
                                        </button>
                                        <input type="hidden"  name="se_pdr_id_edit" id="se_pdr_id_edit" value="<?php echo $pdr_id;?>">
                                        <input type="hidden"  name="se_pid_edit" id="se_pid_edit"value="<?php echo $p_id;?>">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">گزارش نیروی انسانی</h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="alert_message_man_power"></div>

                                <br>

                                <table id="pdr_man_power_tbl" class="table table-responsive-sm table-sm table-hover table-bordered mb-0">

                                    <thead class="thead-inverse">
                                        <tr>
                                            <th class="text-xs-center align-middle" rowspan="3" width="10%">#</th>
                                            <th class="text-xs-center" colspan="3"> نیروی انسانی</th>
                                            <th class="text-xs-center align-middle" rowspan="3" width="10%">عملیات</th>
                                        </tr>
                                        <tr>
                                            <th class="text-xs-center align-middle" rowspan="2">پرسنل کارگاهی</th>
                                            <th class="text-xs-center" colspan="2"> ساعت کارکرد</th>
                                        </tr>
                                        <tr>
                                            <th class="text-xs-center">ورود</th>
                                            <th class="text-xs-center"> خروج</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">گزارش مصالح وارده</h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="alert_message_materials"></div>

                                <br>

                                <table id="pdr_materials_tbl" class="table table-responsive-sm table-sm table-hover table-bordered mb-0">

                                    <thead class="thead-inverse">
                                    <tr>
                                        <th class="text-xs-center align-middle" width="10%">#</th>
                                        <th class="text-xs-center align-middle"> مصالح وارده</th>
                                        <th class="text-xs-center align-middle"> حامل</th>
                                        <th class="text-xs-center align-middle"> واحد </th>
                                        <th class="text-xs-center align-middle"> مقدار </th>
                                        <th class="text-xs-center align-middle" width="10%">عملیات</th>
                                    </tr>

                                    </thead>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">گزارش ماشین آلات و ابزار</h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="alert_message_machinery"></div>

                                <br>

                                <table id="pdr_machinery_tbl" class="table table-responsive-sm table-sm table-hover table-bordered mb-0">

                                    <thead class="thead-inverse">
                                        <tr>
                                            <th class="text-xs-center align-middle" rowspan="3" width="10%">#</th>
                                            <th class="text-xs-center align-middle" colspan="3">ماشین آلات و ابزار</th>
                                            <th class="text-xs-center align-middle" rowspan="3" width="10%">عملیات</th>

                                        </tr>
                                        <tr>
                                            <th class="text-xs-center align-middle" rowspan="2">شرح</th>
                                            <th class="text-xs-center align-middle" colspan="2">ساعت کارکرد</th>
                                        </tr>
                                        <tr>
                                            <th class="text-xs-center align-middle">ورود</th>
                                            <th class="text-xs-center align-middle">خروج</th>
                                        </tr>

                                    </thead>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">گزارش پرداختی ها</h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="collapse"><i class="icon-minus4"></i></a></li>
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <div id="alert_message_peyments"></div>

                                <br>

                                <table id="pdr_peyments_tbl" class="table table-responsive-sm table-sm table-hover table-bordered mb-0">

                                    <thead class="thead-inverse">
                                        <tr>
                                            <th class="text-xs-center align-middle" rowspan="2" style="width: 10%">#</th>
                                            <th class="text-xs-center align-middle" colspan="3">پرداختی</th>
                                            <th class="text-xs-center align-middle" rowspan="2" style="width: 10%">عملیات</th>
                                        </tr>
                                        <tr>
                                            <th class="text-xs-center align-middle">شرح</th>
                                            <th class="text-xs-center align-middle">مبلغ</th>
                                            <th class="text-xs-center align-middle">صندوق</th>
                                        </tr>
                                    </thead>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ////////////////////////////////////////////////////////////////////////////-->

<?php //require_once( plugin_dir_path(__FILE__) . 'footer/footer.php' ); ?>


<!-- BEGIN VENDOR JS-->
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/tether.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/core/libraries/bootstrap.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/perfect-scrollbar.jquery.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/unison.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/blockUI.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/jquery.matchHeight-min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/screenfull.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/extensions/pace.min.js'); ?>" type="text/javascript"></script>
<!-- BEGIN PAGE VENDOR JS-->
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/charts/chart.min.js'); ?>" type="text/javascript"></script>
<!-- END PAGE VENDOR JS-->
<!-- BEGIN ROBUST JS-->
<script src="<?php echo plugins_url('emp/assets-profile/js/core/app-menu.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/core/app.js'); ?>" type="text/javascript"></script>
<!-- END ROBUST JS-->
<!-- BEGIN PAGE LEVEL JS-->
<!--<script src="--><?php //echo plugins_url('emp/assets-profile/js/scripts/pages/dashboard-lite.js'); ?><!--" type="text/javascript"></script>-->

<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/mdb.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/popper.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/datatables.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/dataTables.buttons.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.flash.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/jszip.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/pdfmake.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/vfs_fonts.js'); ?>" type="text/javascript"></script>

<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.html5.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.print.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/persian.js'); ?>" type="text/javascript"></script>


<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/digitSeprator/autonumbric.min.js'); ?>" type="text/javascript"></script>

<script src="<?php echo plugins_url('emp/assets-profile/js/time-picker/mdtimepicker.js'); ?>" type="text/javascript"></script>



<script type="text/javascript">
    // Basic example
    $(document).ready(function ()
    {

        $('body').on('focus',"#se_pdr_date_edit2", function(){
            $(this).pDatepicker({

                "autoClose": true,
                // "initialValue": true,
                // "initialValueType" : 'gregorian',
                "altField": "#se_pdr_date_edit",
                "format" : "YYYY / MM / DD ",
                "altFieldFormatter" :function (unixDate) {
                    var self = this;
                    var pd = new persianDate(unixDate).toCalendar('gregorian').format('X');
                    return pd;
                }
            });
        });



/////////////////////////////////////////////////////////////// start man power///////////////////////////////

        fetch_data_man_power();
        function fetch_data_man_power()
        {
            var dataTable_man_power = $('#pdr_man_power_tbl').DataTable
            (
                {
                    "pagingType": "full_numbers",
                    // "paging": false,
                    "tabIndex": 1,
                    "order": [[ 0, "desc" ]],
                    "pageLength":10,
                    "dom": "Bfrtip",
                    buttons: [
                        {
                            text: '<i class="icon-plus3 fa-lg "></i> &nbsp;سطر جدید',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'add_row_man_power'
                            }
                        },
                        {
                            text: '<i class="icon-printer4 fa-lg"></i> &nbsp;پرینت ',
                            extend :'print',
                            charset: 'utf-8',
                            autoPrint: false,
                            footer: true,
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            exportOptions: {
                                columns: [ 0, 1, 2,3]
                            },
                            title : '',
                            repeatingHead: {
                                <?php
                                require_once( ABSPATH . 'wp-content/plugins/emp/inc/jdf.php' );
                                require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
                                global $wpdb;
                                $table = $wpdb->prefix .'projects';
                                $query = "SELECT * FROM {$table} WHERE id={$p_id} ";
                                $results1 = $wpdb->get_row($query);
                                $employee_data = get_userdata($results1->eid);

                                $table = $wpdb->prefix .'pdaily_reports';
                                $query = "SELECT * FROM {$table} WHERE id={$pdr_id} AND pid={$p_id} ";
                                $results2 = $wpdb->get_row($query);


                                ?>
                                title: '<div class="row">' +
                                    '                 <div class="col-12 text-xs-center">' +
                                                            '<h2><b>گزارش روزانه نیروی انسانی</b></h2>' +
                                    '                 </div>' +
                                    '                <div class="col-12 text-xs-center">' +
                                    '                     <h3><b>پیمانکار :<?php echo $results1->cname?></b></h3>' +
                                    '                </div>' +
                                        '</div>' +
                                    '<div class="row">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                                            //'کارفرما ' +' : ' + '<?php //echo $employee_data ->first_name .  " " .$employee_data->last_name;?>//'+
                                    '                </div>' +
                                    '                <div class="col-xs-6 text-xs-right">' +
                                                    'تاریخ' +' : ' + '<?php echo jdate("Y/m/d",strtotime($results2->date))?>'+
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row pt-2">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                                            'پروژه' +' : ' + '<?php echo $results1->pname?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                                        'حداقل درجه حرارت' +' : ' + '<?php echo $results2->min_temp?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                                        'حداکثر درجه حرارات ' +' : ' + '<?php echo $results2->max_temp?>'+
                                    '                </div>' +
                                    '</div>'

                            },
                            customize: function ( win ) {
                                $(win.document.body)
                                    .css( 'font-size', '10pt');
                                $(win.document.body).find( 'table' )
                                    .addClass( 'compact' )
                                    .css( 'font-size', 'inherit' );
                                $(win.document.body).find( 'thead tr:gt(0) ' ).remove();
                                $(win.document.body).find( 'thead' ).append('                                        <tr>\n' +
                                    '                                            <th class="text-xs-center align-middle" rowspan="3" width="10%">#</th>\n' +
                                    '                                            <th class="text-xs-center" colspan="3"> نیروی انسانی</th>\n' +
                                    '                                        </tr>\n' +
                                    '                                        <tr>\n' +
                                    '                                            <th class="text-xs-center align-middle" rowspan="2">پرسنل کارگاهی</th>\n' +
                                    '                                            <th class="text-xs-center" colspan="2"> ساعت کارکرد</th>\n' +
                                    '                                        </tr>\n' +
                                    '                                        <tr>\n' +
                                    '                                            <th class="text-xs-center">ورود</th>\n' +
                                    '                                            <th class="text-xs-center"> خروج</th>\n' +
                                    '                                        </tr>');
                                $(win.document.body).find( 'table' ).after(

                                    ' <table  class="table table-responsive-sm table-sm table-hover table-bordered mb-0">\n' +
                                    '    <thead>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle" style="padding-top: 35px;border-bottom: 2px black solid;"><h3 class="text-bold-800">ملاحظات</h3></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >شرح اهم فعالیت های صورت گرفته :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->important_works?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >برنامه روز آینده:</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->next_day_plan?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >مشکلات و موانع :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->problems?></th>' +
                                    '       </tr>' +
                                    '  </thead>' +
                                    ' </table>'
                                );
                                traverse(win.document.body);
                            },
                        }
                    ],
                    "searching": false,
                    "bAutoWidth": false,
                    // "filter": false,
                    "language": {
                        "processing": "در حال پردازش اطلاعات ...",
                        "sInfo":"نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                        "emptyTable": "رکوردی یافت نشد",
                        "lengthMenu": "",
                        "zeroRecords": "رکوردی یافت نشد",
                        "info": "",
                        "infoEmpty": "",
                        "infoFiltered": "",
                        "search": "_INPUT_",
                        "searchPlaceholder": "جستجو بر اساس تاریخ",
                        "paginate": {
                            "previous": "بعدی",
                            "next": "قبلی",
                            "last" : "»",
                            "first" : "«"
                        }

                    },
                    // "processing": true,
                    "serverSide": true,
                    "ajax": {
                        "url"  : "<?php echo admin_url('admin-ajax.php?action=pdaily_report_man_power_data&pdr_id=' . $pdr_id)?>"
                    },
                    "fnDrawCallback" : function() {
                        traverse(document.body);
                    }
                }
            );


        }

        persian={0:'۰',1:'۱',2:'۲',3:'۳',4:'۴',5:'۵',6:'۶',7:'۷',8:'۸',9:'۹'};
        function traverse(el){
            if(el.nodeType==3){
                var list=el.data.match(/[0-9]/g);
                if(list!=null && list.length!=0){
                    for(var i=0;i<list.length;i++)
                        el.data=el.data.replace(list[i],persian[list[i]]);
                }
            }
            for(var i=0;i<el.childNodes.length;i++){
                traverse(el.childNodes[i]);
            }
        }


        $(document).on('click', '#add_row_man_power', function(){
            var html = '<tr class="row_insert">';
            html += '<td  id="data1"></td>';
            html += '<td>' +
                '<input type="text" id="pdr_mp_personnel_insert"  name="pdr_mp_personnel_insert" class="text-xs-center">' + '</td>';
            html += '<td  >' +
                '<input type="text" id="pdr_mp_entrance_time_insert" class="text-xs-center"/>' +
                '</td>';
            html += '<td  >' +
                '<input type="text" id="pdr_mp_exit_time_insert" class="text-xs-center"/>' +
                '</td>';


            html += '<td><button type="submit" name="se_pdr_mp_insert" id="se_pdr_mp_insert" class="btn btn-sm btn-success btn-rounded  mr-1 mb-1"> <i class="icon-check2"></i></button><button type="btn" name="se_pdr_mp_cancel" id="se_pdr_mp_cancel" class="btn btn-sm btn-warning  waves-effect waves-light btn-rounded  mr-1 mb-1"> <i class="icon-cross2" ></i></button></td>';
            html += '</tr>';
            $('#pdr_man_power_tbl tbody').prepend(html);
        });

        $('body').on('click',"#se_pdr_mp_cancel", function(){
            $(this).closest("tr").remove();
        });

        $('body').on('focus',"#pdr_mp_entrance_time_insert", function(){
            $(this).mdtimepicker({
                timeFormat: 'hh:mm', // format of the time value (data-time attribute)
                format: 'hh:mm',    // format of the input value
                theme: 'green',        // theme of the timepicker
                readOnly: true     // determines if input is readonly
            });
        });

        $('body').on('focus',"#pdr_mp_exit_time_insert", function(){
            $(this).mdtimepicker({
                timeFormat: 'hh:mm', // format of the time value (data-time attribute)
                format: 'hh:mm',    // format of the input value
                theme: 'green',        // theme of the timepicker
                readOnly: true     // determines if input is readonly
            });
        });


        $(document).on('click', '#se_pdr_mp_insert', function(){
            var pdr_mp_personnel = $('#pdr_mp_personnel_insert').val();
            var pdr_mp_entrance_time = $('#pdr_mp_entrance_time_insert').val();
            var pdr_mp_exit_time = $('#pdr_mp_exit_time_insert').val();

            if(pdr_mp_personnel != '' && pdr_mp_entrance_time != '' && pdr_mp_exit_time != '')
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pdr_mp_insert&pdr_id=' . $pdr_id)?>",
                    data:{
                        pdr_mp_personnel:pdr_mp_personnel,
                        pdr_mp_entrance_time:pdr_mp_entrance_time,
                        pdr_mp_exit_time:pdr_mp_exit_time
                    },
                    success:function(data)
                    {
                        $('#alert_message_man_power').html('<div class="alert alert-success">'+data+'</div>');
                        $('#pdr_man_power_tbl').DataTable().destroy();
                        fetch_data_man_power();
                    }
                });
                setInterval(function(){
                    $('#alert_message_man_power').html('');
                }, 5000);
            }
            else
            {
                alert("لطفا تمامی فیلد ها را وارد نمایید!");
            }
        });

        $(document).on('click', '#se_pdr_mp_delete', function(){
            var id = $(this).data("id");
            if(confirm("مطمئن هستید?"))
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pdr_mp_delete')?>",
                    data:{
                        id:id,
                    },
                    success:function(data){
                        $('#alert_message_man_power').html('<div class="alert alert-success">'+data+'</div>');
                        $('#pdr_man_power_tbl').DataTable().destroy();
                        fetch_data_man_power();
                    }
                });
                setInterval(function(){
                    $('#alert_message_man_power').html('');
                }, 5000);
            }
        });


/////////////////////////////////////////////////////////////// start materials//////////////////////////////

        fetch_data_materials();
        function fetch_data_materials()
        {
            var dataTable_materials = $('#pdr_materials_tbl').DataTable
            (
                {
                    "pagingType": "full_numbers",
                    // "paging": false,
                    "tabIndex": 1,
                    "order": [[ 0, "desc" ]],
                    "pageLength":10,
                    "dom": "Bfrtip",
                    buttons: [
                        {
                            text: '<i class="icon-plus3 fa-lg "></i> &nbsp;سطر جدید',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'add_row_materials'
                            }
                        },
                        {
                            text: '<i class="icon-printer4 fa-lg"></i> &nbsp;پرینت ',
                            extend :'print',
                            charset: 'utf-8',
                            autoPrint: false,
                            footer: true,
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            exportOptions: {
                                columns: [ 0, 1, 2,3,4]
                            },
                            title : '',
                            repeatingHead: {
                                <?php
                                require_once( ABSPATH . 'wp-content/plugins/emp/inc/jdf.php' );
                                require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
                                global $wpdb;
                                $table = $wpdb->prefix .'projects';
                                $query = "SELECT * FROM {$table} WHERE id={$p_id} ";
                                $results1 = $wpdb->get_row($query);
                                $employee_data = get_userdata($results1->eid);

                                $table = $wpdb->prefix .'pdaily_reports';
                                $query = "SELECT * FROM {$table} WHERE id={$pdr_id} AND pid={$p_id} ";
                                $results2 = $wpdb->get_row($query);


                                ?>
                                title: '<div class="row">' +
                                    '                 <div class="col-12 text-xs-center">' +
                                    '<h2><b>گزارش روزانه نیروی انسانی</b></h2>' +
                                    '                 </div>' +
                                    '                <div class="col-12 text-xs-center">' +
                                    '                     <h3><b>پیمانکار :<?php echo $results1->cname?></b></h3>' +
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                    //'کارفرما ' +' : ' + '<?php //echo $employee_data ->first_name .  " " .$employee_data->last_name;?>//'+
                                    '                </div>' +
                                    '                <div class="col-xs-6 text-xs-right">' +
                                    'تاریخ' +' : ' + '<?php echo jdate("Y/m/d",strtotime($results2->date))?>'+
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row pt-2">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                    'پروژه' +' : ' + '<?php echo $results1->pname?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                    'حداقل درجه حرارت' +' : ' + '<?php echo $results2->min_temp?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                    'حداکثر درجه حرارات ' +' : ' + '<?php echo $results2->max_temp?>'+
                                    '                </div>' +
                                    '</div>'

                            },
                            customize: function ( win ) {
                                $(win.document.body)
                                    .css( 'font-size', '10pt');
                                $(win.document.body).find( 'table' )
                                    .addClass( 'compact' )
                                    .css( 'font-size', 'inherit' );
                                $(win.document.body).find( 'thead tr th' ).addClass('text-xs-center');
                                $(win.document.body).find( 'table' ).after(

                                    ' <table  class="table table-responsive-sm table-sm table-hover table-bordered mb-0">\n' +
                                    '    <thead>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle" style="padding-top: 35px;border-bottom: 2px black solid;"><h3 class="text-bold-800">ملاحظات</h3></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >شرح اهم فعالیت های صورت گرفته :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->important_works?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >برنامه روز آینده:</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->next_day_plan?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >مشکلات و موانع :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->problems?></th>' +
                                    '       </tr>' +
                                    '  </thead>' +
                                    ' </table>'
                                );
                                traverse(win.document.body);
                            },
                        }
                    ],
                    "searching": false,
                    "bAutoWidth": false,
                    // "filter": false,
                    "language": {
                        "processing": "در حال پردازش اطلاعات ...",
                        "sInfo":"نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                        "emptyTable": "رکوردی یافت نشد",
                        "lengthMenu": "",
                        "zeroRecords": "رکوردی یافت نشد",
                        "info": "",
                        "infoEmpty": "",
                        "infoFiltered": "",
                        "search": "_INPUT_",
                        "searchPlaceholder": "جستجو بر اساس تاریخ",
                        "paginate": {
                            "previous": "بعدی",
                            "next": "قبلی",
                            "last" : "»",
                            "first" : "«"
                        }

                    },
                    // "processing": true,
                    "serverSide": true,
                    "ajax": {
                        "url"  : "<?php echo admin_url('admin-ajax.php?action=pdaily_report_materials_data&pdr_id=' . $pdr_id)?>"
                    },
                    "fnDrawCallback" : function() {
                        traverse(document.body);
                    }
                }
            );


        }



        $(document).on('click', '#add_row_materials', function(){
            var html = '<tr class="row_insert">';
            html += '<td  id="data1"></td>';
            html += '<td>' +
                '<input type="text" id="pdr_materials_title_insert"  name="pdr_materials_title_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="text" id="pdr_materials_carrier_insert"  name="pdr_materials_carrier_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="text" id="pdr_materials_unit_insert"  name="pdr_materials_unit_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="text" id="pdr_materials_amount_insert"  name="pdr_materials_amount_insert" class="text-xs-center">' + '</td>';

            html += '<td><button type="submit" name="se_pdr_materials_insert" id="se_pdr_materials_insert" class="btn btn-sm btn-success btn-rounded  mr-1 mb-1"> <i class="icon-check2"></i></button><button type="btn" name="se_pdr_materials_cancel" id="se_pdr_materials_cancel" class="btn btn-sm btn-warning  waves-effect waves-light btn-rounded  mr-1 mb-1"> <i class="icon-cross2" ></i></button></td>';
            html += '</tr>';
            $('#pdr_materials_tbl tbody').prepend(html);
        });

        $('body').on('click',"#se_pdr_materials_cancel", function(){
            $(this).closest("tr").remove();
        });


        $(document).on('click', '#se_pdr_materials_insert', function(){
            var pdr_materials_title = $('#pdr_materials_title_insert').val();
            var pdr_materials_carrier = $('#pdr_materials_carrier_insert').val();
            var pdr_materials_unit = $('#pdr_materials_unit_insert').val();
            var pdr_materials_amount = $('#pdr_materials_amount_insert').val();



            if(pdr_materials_title != '' && pdr_materials_carrier != '' && pdr_materials_unit != '' && pdr_materials_amount != '')
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pdr_materials_insert&pdr_id=' . $pdr_id)?>",
                    data:{
                        pdr_materials_title:pdr_materials_title,
                        pdr_materials_carrier:pdr_materials_carrier,
                        pdr_materials_unit:pdr_materials_unit,
                        pdr_materials_amount:pdr_materials_amount
                    },
                    success:function(data)
                    {
                        $('#alert_message_materials').html('<div class="alert alert-success">'+data+'</div>');
                        $('#pdr_materials_tbl').DataTable().destroy();
                        fetch_data_materials();
                    }
                });
                setInterval(function(){
                    $('#alert_message_materials').html('');
                }, 5000);
            }
            else
            {
                alert("لطفا تمامی فیلد ها را وارد نمایید!");
            }
        });


        $(document).on('click', '#se_pdr_materials_delete', function(){
            var id = $(this).data("id");
            if(confirm("مطمئن هستید?")) {
                $.ajax({
                    url: "<?php echo admin_url('admin-ajax.php?action=pdr_materials_delete')?>",
                    data: {
                        id: id,
                    },
                    success: function (data) {
                        $('#alert_message_materials').html('<div class="alert alert-success">' + data + '</div>');
                        $('#pdr_materials_tbl').DataTable().destroy();
                        fetch_data_materials();
                    }
                });
                setInterval(function () {
                    $('#alert_message_materials').html('');
                }, 5000);
            }
        });


        /////////////////////////////////////////////////////////////// start machinery//////////////////////////////

        fetch_data_machinery();
        function fetch_data_machinery()
        {
            var dataTable_machinery = $('#pdr_machinery_tbl').DataTable
            (
                {
                    "pagingType": "full_numbers",
                    // "paging": false,
                    "tabIndex": 1,
                    "order": [[ 0, "desc" ]],
                    "pageLength":10,
                    "dom": "Bfrtip",
                    buttons: [
                        {
                            text: '<i class="icon-plus3 fa-lg "></i> &nbsp;سطر جدید',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'add_row_machinery'
                            }
                        },
                        {
                            text: '<i class="icon-printer4 fa-lg"></i> &nbsp;پرینت ',
                            extend :'print',
                            charset: 'utf-8',
                            autoPrint: false,
                            footer: true,
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            exportOptions: {
                                columns: [ 0, 1, 2,3]
                            },
                            title : '',
                            repeatingHead: {
                                <?php
                                require_once( ABSPATH . 'wp-content/plugins/emp/inc/jdf.php' );
                                require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
                                global $wpdb;
                                $table = $wpdb->prefix .'projects';
                                $query = "SELECT * FROM {$table} WHERE id={$p_id} ";
                                $results1 = $wpdb->get_row($query);
                                $employee_data = get_userdata($results1->eid);

                                $table = $wpdb->prefix .'pdaily_reports';
                                $query = "SELECT * FROM {$table} WHERE id={$pdr_id} AND pid={$p_id} ";
                                $results2 = $wpdb->get_row($query);


                                ?>
                                title: '<div class="row">' +
                                    '                 <div class="col-12 text-xs-center">' +
                                    '<h2><b>گزارش روزانه نیروی انسانی</b></h2>' +
                                    '                 </div>' +
                                    '                <div class="col-12 text-xs-center">' +
                                    '                     <h3><b>پیمانکار :<?php echo $results1->cname?></b></h3>' +
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                    //'کارفرما ' +' : ' + '<?php //echo $employee_data ->first_name .  " " .$employee_data->last_name;?>//'+
                                    '                </div>' +
                                    '                <div class="col-xs-6 text-xs-right">' +
                                    'تاریخ' +' : ' + '<?php echo jdate("Y/m/d",strtotime($results2->date))?>'+
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row pt-2">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                    'پروژه' +' : ' + '<?php echo $results1->pname?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                    'حداقل درجه حرارت' +' : ' + '<?php echo $results2->min_temp?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                    'حداکثر درجه حرارات ' +' : ' + '<?php echo $results2->max_temp?>'+
                                    '                </div>' +
                                    '</div>'

                            },
                            customize: function ( win ) {
                                $(win.document.body)
                                    .css( 'font-size', '10pt');
                                $(win.document.body).find( 'table' )
                                    .addClass( 'compact' )
                                    .css( 'font-size', 'inherit' );
                                $(win.document.body).find( 'thead tr:gt(0) ' ).remove();
                                $(win.document.body).find( 'thead' ).append('                                        <tr>\n' +
                                    '                                            <th class="text-xs-center align-middle" rowspan="3" width="10%">#</th>\n' +
                                    '                                            <th class="text-xs-center" colspan="3">ماشین آلات و ابزار</th>\n' +
                                    '                                        </tr>\n' +
                                    '                                        <tr>\n' +
                                    '                                            <th class="text-xs-center align-middle" rowspan="2">شرح</th>\n' +
                                    '                                            <th class="text-xs-center" colspan="2"> ساعت کارکرد</th>\n' +
                                    '                                        </tr>\n' +
                                    '                                        <tr>\n' +
                                    '                                            <th class="text-xs-center">ورود</th>\n' +
                                    '                                            <th class="text-xs-center"> خروج</th>\n' +
                                    '                                        </tr>');
                                $(win.document.body).find( 'table' ).after(

                                    ' <table  class="table table-responsive-sm table-sm table-hover table-bordered mb-0">\n' +
                                    '    <thead>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle" style="padding-top: 35px;border-bottom: 2px black solid;"><h3 class="text-bold-800">ملاحظات</h3></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >شرح اهم فعالیت های صورت گرفته :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->important_works?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >برنامه روز آینده:</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->next_day_plan?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >مشکلات و موانع :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->problems?></th>' +
                                    '       </tr>' +
                                    '  </thead>' +
                                    ' </table>'
                                );
                                traverse(win.document.body);
                            },
                        }
                    ],
                    "searching": false,
                    "bAutoWidth": false,
                    // "filter": false,
                    "language": {
                        "processing": "در حال پردازش اطلاعات ...",
                        "sInfo":"نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                        "emptyTable": "رکوردی یافت نشد",
                        "lengthMenu": "",
                        "zeroRecords": "رکوردی یافت نشد",
                        "info": "",
                        "infoEmpty": "",
                        "infoFiltered": "",
                        "search": "_INPUT_",
                        "searchPlaceholder": "جستجو بر اساس تاریخ",
                        "paginate": {
                            "previous": "بعدی",
                            "next": "قبلی",
                            "last" : "»",
                            "first" : "«"
                        }

                    },
                    // "processing": true,
                    "serverSide": true,
                    "ajax": {
                        "url"  : "<?php echo admin_url('admin-ajax.php?action=pdaily_report_machinery_data&pdr_id=' . $pdr_id)?>"
                    },
                    "fnDrawCallback" : function() {
                        traverse(document.body);
                    }
                }
            );


        }



        $(document).on('click', '#add_row_machinery', function(){
            var html = '<tr class="row_insert">';
            html += '<td  id="data1"></td>';
            html += '<td>' +
                '<input type="text" id="pdr_machinery_title_insert"  name="pdr_machinery_title_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="text" id="pdr_machinery_entrance_time_insert"  name="pdr_machinery_entrance_time_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="text" id="pdr_machinery_exit_time_insert"  name="pdr_machinery_exit_time_insert" class="text-xs-center">' + '</td>';


            html += '<td><button type="submit" name="se_pdr_machinery_insert" id="se_pdr_machinery_insert" class="btn btn-sm btn-success btn-rounded  mr-1 mb-1"> <i class="icon-check2"></i></button><button type="btn" name="se_pdr_machinery_cancel" id="se_pdr_machinery_cancel" class="btn btn-sm btn-warning  waves-effect waves-light btn-rounded  mr-1 mb-1"> <i class="icon-cross2" ></i></button></td>';
            html += '</tr>';
            $('#pdr_machinery_tbl tbody').prepend(html);
        });

        $('body').on('focus',"#pdr_machinery_exit_time_insert", function(){
            $(this).mdtimepicker({
                timeFormat: 'hh:mm', // format of the time value (data-time attribute)
                format: 'hh:mm',    // format of the input value
                theme: 'green',        // theme of the timepicker
                readOnly: true     // determines if input is readonly
            });
        });

        $('body').on('focus',"#pdr_machinery_entrance_time_insert", function(){
            $(this).mdtimepicker({
                timeFormat: 'hh:mm', // format of the time value (data-time attribute)
                format: 'hh:mm',    // format of the input value
                theme: 'green',        // theme of the timepicker
                readOnly: true     // determines if input is readonly
            });
        });

        $('body').on('click',"#se_pdr_machinery_cancel", function(){
            $(this).closest("tr").remove();
        });


        $(document).on('click', '#se_pdr_machinery_insert', function(){
            var pdr_machinery_title = $('#pdr_machinery_title_insert').val();
            var pdr_machinery_entrance_time = $('#pdr_machinery_entrance_time_insert').val();
            var pdr_machinery_exit_time= $('#pdr_machinery_exit_time_insert').val();



            if(pdr_machinery_title != '' && pdr_machinery_entrance_time != '' && pdr_machinery_exit_time != '')
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pdr_machinery_insert&pdr_id=' . $pdr_id)?>",
                    data:{
                        pdr_machinery_title:pdr_machinery_title,
                        pdr_machinery_entrance_time:pdr_machinery_entrance_time,
                        pdr_machinery_exit_time:pdr_machinery_exit_time
                    },
                    success:function(data)
                    {
                        $('#alert_message_machinery').html('<div class="alert alert-success">'+data+'</div>');
                        $('#pdr_machinery_tbl').DataTable().destroy();
                        fetch_data_machinery();
                    }
                });
                setInterval(function(){
                    $('#alert_message_machinery').html('');
                }, 5000);
            }
            else
            {
                alert("لطفا تمامی فیلد ها را وارد نمایید!");
            }
        });


        $(document).on('click', '#se_pdr_machinery_delete', function(){
            var id = $(this).data("id");
            if(confirm("مطمئن هستید?")) {
                $.ajax({
                    url: "<?php echo admin_url('admin-ajax.php?action=pdr_machinery_delete')?>",
                    data: {
                        id: id,
                    },
                    success: function (data) {
                        $('#alert_message_machinery').html('<div class="alert alert-success">' + data + '</div>');
                        $('#pdr_machinery_tbl').DataTable().destroy();
                        fetch_data_machinery();
                    }
                });
                setInterval(function () {
                    $('#alert_message_machinery').html('');
                }, 5000);
            }
        });

        /////////////////////////////////////////////////////////////// start peyments//////////////////////////////

        fetch_data_peyments();
        function fetch_data_peyments()
        {
            var dataTable_peyments = $('#pdr_peyments_tbl').DataTable
            (
                {
                    "pagingType": "full_numbers",
                    // "paging": false,
                    "tabIndex": 1,
                    "order": [[ 0, "desc" ]],
                    "pageLength":10,
                    "dom": "Bfrtip",
                    buttons: [
                        {
                            text: '<i class="icon-plus3 fa-lg "></i> &nbsp;سطر جدید',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'add_row_peyments'
                            }
                        },
                        {
                            text: '<i class="icon-printer4 fa-lg"></i> &nbsp;پرینت ',
                            extend :'print',
                            charset: 'utf-8',
                            autoPrint: false,
                            footer: true,
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            exportOptions: {
                                columns: [ 0, 1, 2,3]
                            },
                            title : '',
                            repeatingHead: {
                                <?php
                                require_once( ABSPATH . 'wp-content/plugins/emp/inc/jdf.php' );
                                require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
                                global $wpdb;
                                $table = $wpdb->prefix .'projects';
                                $query = "SELECT * FROM {$table} WHERE id={$p_id} ";
                                $results1 = $wpdb->get_row($query);
                                $employee_data = get_userdata($results1->eid);

                                $table = $wpdb->prefix .'pdaily_reports';
                                $query = "SELECT * FROM {$table} WHERE id={$pdr_id} AND pid={$p_id} ";
                                $results2 = $wpdb->get_row($query);


                                ?>
                                title: '<div class="row">' +
                                    '                 <div class="col-12 text-xs-center">' +
                                    '<h2><b>گزارش روزانه نیروی انسانی</b></h2>' +
                                    '                 </div>' +
                                    '                <div class="col-12 text-xs-center">' +
                                    '                     <h3><b>پیمانکار :<?php echo $results1->cname?></b></h3>' +
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                    //'کارفرما ' +' : ' + '<?php //echo $employee_data ->first_name .  " " .$employee_data->last_name;?>//'+
                                    '                </div>' +
                                    '                <div class="col-xs-6 text-xs-right">' +
                                    'تاریخ' +' : ' + '<?php echo jdate("Y/m/d",strtotime($results2->date))?>'+
                                    '                </div>' +
                                    '</div>' +
                                    '<div class="row pt-2">' +
                                    '                <div class="col-xs-6 text-xs-left">' +
                                    'پروژه' +' : ' + '<?php echo $results1->pname?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                    'حداقل درجه حرارت' +' : ' + '<?php echo $results2->min_temp?>'+
                                    '                </div>' +
                                    '                <div class="col-xs-3 text-xs-right">' +
                                    'حداکثر درجه حرارات ' +' : ' + '<?php echo $results2->max_temp?>'+
                                    '                </div>' +
                                    '</div>'

                            },
                            customize: function ( win ) {
                                $(win.document.body)
                                    .css( 'font-size', '10pt');
                                $(win.document.body).find( 'table' )
                                    .addClass( 'compact' )
                                    .css( 'font-size', 'inherit' );
                                $(win.document.body).find( 'thead tr:gt(0) ' ).remove();
                                $(win.document.body).find( 'thead' ).append('' +
                                    '                                        <tr>\n' +
                                    '                                            <th class="text-xs-center align-middle" rowspan="2" style="width: 10%">#</th>\n' +
                                    '                                            <th class="text-xs-center align-middle" colspan="3">پرداختی</th>\n' +
                                    '                                        </tr>\n' +
                                    '                                        <tr>\n' +
                                    '                                            <th class="text-xs-center align-middle">شرح</th>\n' +
                                    '                                            <th class="text-xs-center align-middle">مبلغ</th>\n' +
                                    '                                            <th class="text-xs-center align-middle">صندوق</th>\n' +
                                    '                                        </tr>');
                                $(win.document.body).find( 'table' ).after(

                                    ' <table  class="table table-responsive-sm table-sm table-hover table-bordered mb-0">\n' +
                                    '    <thead>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle" style="padding-top: 35px;border-bottom: 2px black solid;"><h3 class="text-bold-800">ملاحظات</h3></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >شرح اهم فعالیت های صورت گرفته :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->important_works?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >برنامه روز آینده:</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->next_day_plan?></th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-left align-middle" >مشکلات و موانع :</th>' +
                                    '       </tr>' +
                                    '        <tr>' +
                                    '           <th class="text-xs-center align-middle"><?php echo $results2->problems?></th>' +
                                    '       </tr>' +
                                    '  </thead>' +
                                    ' </table>'
                                );
                                traverse(win.document.body);
                            },
                        }
                    ],
                    "searching": false,
                    "bAutoWidth": false,
                    // "filter": false,
                    "language": {
                        "processing": "در حال پردازش اطلاعات ...",
                        "sInfo":"نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                        "emptyTable": "رکوردی یافت نشد",
                        "lengthMenu": "",
                        "zeroRecords": "رکوردی یافت نشد",
                        "info": "",
                        "infoEmpty": "",
                        "infoFiltered": "",
                        "search": "_INPUT_",
                        "searchPlaceholder": "جستجو بر اساس تاریخ",
                        "paginate": {
                            "previous": "بعدی",
                            "next": "قبلی",
                            "last" : "»",
                            "first" : "«"
                        }

                    },
                    // "processing": true,
                    "serverSide": true,
                    "ajax": {
                        "url"  : "<?php echo admin_url('admin-ajax.php?action=pdaily_report_peyments_data&pdr_id=' . $pdr_id)?>"
                    },
                    "fnDrawCallback" : function() {
                        traverse(document.body);
                    }
                }
            );


        }



        $(document).on('click', '#add_row_peyments', function(){
            var html = '<tr class="row_insert">';
            html += '<td  id="data1"></td>';
            html += '<td>' +
                '<input type="text" id="pdr_peyments_title_insert"  name="pdr_peyments_title_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="number" id="pdr_peyments_amount_insert"  name="pdr_peyments_amount_insert" class="text-xs-center">' + '</td>';

            html += '<td>' +
                '<input type="text" id="pdr_peyments_bin_insert"  name="pdr_peyments_bin_insert" class="text-xs-center">' + '</td>';


            html += '<td><button type="submit" name="se_pdr_peyments_insert" id="se_pdr_peyments_insert" class="btn btn-sm btn-success btn-rounded  mr-1 mb-1"> <i class="icon-check2"></i></button><button type="btn" name="se_pdr_peyments_cancel" id="se_pdr_peyments_cancel" class="btn btn-sm btn-warning  waves-effect waves-light btn-rounded  mr-1 mb-1"> <i class="icon-cross2" ></i></button></td>';
            html += '</tr>';
            $('#pdr_peyments_tbl tbody').prepend(html);
        });

        $('body').on('click',"#se_pdr_peyments_cancel", function(){
            $(this).closest("tr").remove();
        });

        $(document).on('click', '#se_pdr_peyments_insert', function(){
            var pdr_peyments_title = $('#pdr_peyments_title_insert').val();
            var pdr_peyments_amount = $('#pdr_peyments_amount_insert').val();
            var pdr_peyments_bin= $('#pdr_peyments_bin_insert').val();



            if(pdr_peyments_title != '' && pdr_peyments_amount != '' && pdr_peyments_bin != '')
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pdr_peyments_insert&pdr_id=' . $pdr_id)?>",
                    data:{
                        pdr_peyments_title:pdr_peyments_title,
                        pdr_peyments_amount:pdr_peyments_amount,
                        pdr_peyments_bin:pdr_peyments_bin
                    },
                    success:function(data)
                    {
                        $('#alert_message_peyments').html('<div class="alert alert-success">'+data+'</div>');
                        $('#pdr_peyments_tbl').DataTable().destroy();
                        fetch_data_peyments();
                    }
                });
                setInterval(function(){
                    $('#alert_message_machinery').html('');
                }, 5000);
            }
            else
            {
                alert("لطفا تمامی فیلد ها را وارد نمایید!");
            }
        });

        $(document).on('click', '#se_pdr_peyments_delete', function(){
            var id = $(this).data("id");
            if(confirm("مطمئن هستید?")) {
                $.ajax({
                    url: "<?php echo admin_url('admin-ajax.php?action=pdr_peyments_delete')?>",
                    data: {
                        id: id,
                    },
                    success: function (data) {
                        $('#alert_message_peyments').html('<div class="alert alert-success">' + data + '</div>');
                        $('#pdr_peyments_tbl').DataTable().destroy();
                        fetch_data_peyments();
                    }
                });
                setInterval(function () {
                    $('#alert_message_peyments').html('');
                }, 5000);
            }
        });

    });





</script>
<!-- END PAGE LEVEL JS-->

</body>

</html>

