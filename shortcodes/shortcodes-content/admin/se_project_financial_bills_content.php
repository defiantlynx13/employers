<html lang="en" data-textdirection="rtl" class="loading">

<!-- Mirrored from pixinvent.com/free-bootstrap-template/robust-lite/html/rtl/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 28 Jun 2017 06:37:27 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Robust admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, robust admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>وب سایت من</title>
    <link rel="apple-touch-icon" sizes="60x60" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-60.png'); ?>">
    <link rel="apple-touch-icon" sizes="76x76" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-76.png'); ?>">
    <link rel="apple-touch-icon" sizes="120x120" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-120.png'); ?>">
    <link rel="apple-touch-icon" sizes="152x152" href="<?php echo plugins_url('emp/assets-profile/images/ico/apple-icon-152.png'); ?>">

    <link rel="shortcut icon" type="image/x-icon" href="https://pixinvent.com/free-bootstrap-template/robust-lite/app-assets/images/ico/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="<?php echo plugins_url('emp/assets-profile/images/ico/favicon-32.png'); ?>">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!-- BEGIN VENDOR CSS-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/bootstrap.css'); ?>">
    <!-- font icons-->

    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/fonts/icomoon.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/fonts/flag-icon-css/css/flag-icon.min.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/vendors/css/extensions/pace.css'); ?>">
    <!-- END VENDOR CSS-->
    <!-- BEGIN ROBUST CSS-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/bootstrap-extended.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/app.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/colors.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/custom-rtl.css'); ?>">
    <!-- END ROBUST CSS-->
    <!-- BEGIN Page Level CSS-->

    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/core/menu/menu-types/vertical-menu.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/core/menu/menu-types/vertical-overlay-menu.css'); ?>">
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/pages/login-register.css'); ?>">

    <!-- END Page Level CSS-->
    <!-- BEGIN Custom CSS-->
    <!--    <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css/style-rtl.css'); ?><!--">-->
    <!-- END Custom CSS-->

    <!-- BEGIN Custom font-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets/css/login-style.css'); ?>">
    <!-- END Custom Font-->



    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/mdb/mdb.min.css'); ?>">
<!--    <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css-rtl/mdb/jquery.dataTables.min.css'); ?><!--">-->
<!--    <link rel="stylesheet" type="text/css" href="--><?php //echo plugins_url('emp/assets-profile/css-rtl/mdb/buttons.dataTables.min.css'); ?><!--">-->
    <link rel="stylesheet" type="text/css" href="<?php echo plugins_url('emp/assets-profile/css-rtl/persian-date/persian-datepicker.min.css'); ?>">


    <style type="text/css">

        [data-notify="progressbar"] {
            margin-bottom: 0px;
            position: absolute;
            bottom: 0px;
            left: 0px;
            width: 100%;
            height: 5px;
        }
        [data-notify="dismiss"] {
            float: left;
        }
        @media screen and (min-width: 640px) {
            .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
                text-align: left;
            }
        }
        .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
            margin: 10px;
        }
        .custom-select{
            font-family: IRANSansWeb;
        }

        .popover{
            left: 0;
            right: auto;
            font-family: IRANSansWeb;
        }

        .popover-content {
            display: none;
        }
        .btn-floating{
            margin: 0px;
        }
        .datepicker-plot-area{
            font-family: IRANSansWeb;
        }
        .trigger {
            padding: 1px 10px;
            font-size: 12px;
            font-weight: 400;
            border-radius: 10px;
            background-color: #eee;
            color: #212121;
            display: inline-block;
            margin: 2px 5px;
        }

        .hoverable, .trigger {
            transition: box-shadow 0.55s;
            box-shadow: 0;
        }

        .hoverable:hover, .trigger:hover {
            transition: box-shadow 0.45s;
            box-shadow: 0 8px 17px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

        td{
            direction: ltr;
            text-align: center;
            font-family: IRANSansWeb !important;
        }

        div.dt-buttons{
            float: right;
        }
        button.dt-button, div.dt-button, a.dt-button{
            border-radius: 40px;
        }

        .dataTables_info{
            float: left;
            padding: 20px;
        }
    </style>

</head>
<body data-open="click" data-menu="vertical-menu" data-col="2-columns" class="vertical-layout vertical-menu 2-columns  fixed-navbar">
<!-- navbar-fixed-top-->

<?php require_once( plugin_dir_path(__FILE__) . 'header/header.php' ); ?>

<!-- ////////////////////////////////////////////////////////////////////////////-->


<!-- main menu-->
<div data-scroll-to-active="true" class="main-menu menu-fixed menu-dark menu-accordion menu-shadow">
    <!-- main menu header-->
    <div class="main-menu-header">
        <!--            <input type="text" placeholder="Search" class="menu-search form-control round"/>-->
    </div>
    <!-- / main menu header-->
    <!-- main menu content-->
    <?php require_once( plugin_dir_path(__FILE__) . 'sidebar/sidebar-menu.php' ); ?>
    <!-- /main menu content-->
    <!-- main menu footer-->
    <!-- include includes/menu-footer-->
    <!-- main menu footer-->
</div>
<!-- / main menu-->

<div class="app-content content container-fluid">
    <div class="content-wrapper">

        <div class="content-body">
            <?php
            require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
            global $wpdb;
            if (isset($_GET['p_id']))
            {
                $p_id=intval($_GET['p_id']);
                $table = $wpdb->prefix .'projects';
                $query = "SELECT * FROM {$table} WHERE id={$p_id}";
                $results=$wpdb->get_results($query);
                if (count($results)==0)
                {
                        wp_redirect(home_url().'/se_panel');
                }
            }
            else
            {
                wp_redirect(home_url().'/se_panel');
            }

            ?>
        <div class="content-body">
            <div class="row">
                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php
                    $table = $wpdb->prefix .'projects';
                    $query = "SELECT * FROM {$table} WHERE id={$p_id}";
                    $result=$wpdb->get_row($query);
                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media">
                                    <div class="media-body text-xs-center">
                                        <span>پروژه : <?php echo $result->pname.'  ';?></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php
                    $employee=get_userdata($result->eid);
                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media">
                                    <div class="media-body text-xs-center">
                                        <span>کارفرما :  <b><?php echo $employee->first_name .  " " .$employee->last_name?></b></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <?php


                    $table = $wpdb->prefix .'pfinancial_bills';
                    $query = "SELECT * FROM {$table} WHERE pid={$p_id} ";
                    $result_test=$wpdb->get_results($query);
                    if (count($result_test) == 0)
                    {
                        $fpb_total =0;
                    }
                    else
                    {


                        $table = $wpdb->prefix .'pfinancial_bills';
                        $query = "SELECT * FROM {$table} WHERE pid={$p_id} AND pfb_title LIKE 'pss%' ORDER BY pfb_title DESC ";
                        $result_fb_pss=$wpdb->get_row($query);

                        $fb_pss_sum=$result_fb_pss->pfb_amount;

                        $query = "SELECT * FROM {$table} WHERE pid={$p_id} AND pfb_title NOT LIKE 'pss%' ";
                        $result_fbs=$wpdb->get_results($query);

                        $temp_sum=0;
                        foreach ($result_fbs as $result_fb)
                        {
                            $temp_sum+=$result_fb->pfb_amount;
                        }
                        $fpb_total = $temp_sum + $fb_pss_sum;
                    }

                    ?>
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media">
                                    <div class="media-body text-xs-center">
                                        <span>  جمع کل  :<b id="pfb_total">&nbsp;&nbsp;<?php echo $fpb_total; ?></b>  ریال</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-xs-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-block">
                                <div class="media ">
                                    <div class="media-body text-xs-center">
                                        <?php
                                            if ($fpb_total>0)
                                            {
                                                echo '<span ><b style="color: green;" id="pfb_msg"> کارفرما بستانکار است !</b></span>';
                                            }
                                            elseif ($fpb_total < 0)
                                            {
                                                echo '<span ><b style="color: red;" id="pfb_msg"> کارفرما بدهکار است !</b></span>';
                                            }
                                            else
                                            {
                                                echo '<span ><b id="pfb_msg"> کارفرما تسویه کرده است !</b></span>';
                                            }
                                        ?>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <p>
                <span class="float-xs-right">
                    <a type="button" class="btn purple-gradient btn-rounded white mr-1 mb-1 waves-effect waves-light" href="<?php echo home_url('se_panel');?>">
                        بازگشت به لیست پروژه ها
                        <i class="icon-arrow-left4 fa-lg"></i>
                    </a>
                </span>
            </p>

            <div class="row">
                <div class="col-xs-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">جدول صورت حساب مالی پروژه</h4>
                            <a class="heading-elements-toggle"><i class="icon-ellipsis font-medium-3"></i></a>
                            <div class="heading-elements">
                                <ul class="list-inline mb-0">
                                    <li><a data-action="expand"><i class="icon-expand2"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="card-block">
                                <p>
                                    <span class="float-xs-left red-text">
                                        <b>
                                            <i class="icon-check"></i> برای وارد کردن صورت وضعیت، تنها <i style="    border: 1px dashed green; color: green;padding: 0 5px;">شماره</i> صورت وضعیت را وارد نمایید!
                                        </b>
                                    </span>
                                </p>
                            </div>
                            <div class="table-responsive">
                                <div id="alert_message"></div>
<!--                                <table  class="table table-hover table-bordered mb-0">-->
<!--                                    <thead>-->
<!--                                    <tr>-->
<!--                                        <th class="text-xs-center" style="width: 50%">جمع کل</th>-->
<!--                                        <th id="se_pfb_sum" class="text-xs-center" style="width: 15%;    direction: ltr "></th>-->
<!--                                        <th id="se_pfb_msg" class="text-xs-center" style="width: 35%" colspan="2"></th>-->
<!---->
<!--                                    </tr>-->
<!--                                    </thead>-->
<!--                                </table>-->
                                <br>
                                <table id="pfb_tbl" class="table table-hover table_sm table-bordered mb-0">
                                    <thead class="thead-default">
                                    <tr>
                                        <th class="text-xs-center">#</th>
                                        <th class="text-xs-center">موضوع</th>
                                        <th class="text-xs-center">تاریخ</th>
                                        <th class="text-xs-center">مبلغ(ریال)</th>
                                        <th class="text-xs-center">توضیحات</th>
                                        <th class="text-xs-center">عملیات</th>
                                    </tr>
                                    </thead>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ////////////////////////////////////////////////////////////////////////////-->

<?php //require_once( plugin_dir_path(__FILE__) . 'footer/footer.php' ); ?>


<!-- BEGIN VENDOR JS-->
<script src="<?php echo plugins_url('emp/assets-profile/js/core/libraries/jquery.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/tether.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/core/libraries/bootstrap.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/perfect-scrollbar.jquery.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/unison.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/blockUI.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/jquery.matchHeight-min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/ui/screenfull.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/extensions/pace.min.js'); ?>" type="text/javascript"></script>
<!-- BEGIN PAGE VENDOR JS-->
<script src="<?php echo plugins_url('emp/assets-profile/vendors/js/charts/chart.min.js'); ?>" type="text/javascript"></script>
<!-- END PAGE VENDOR JS-->
<!-- BEGIN ROBUST JS-->
<script src="<?php echo plugins_url('emp/assets-profile/js/core/app-menu.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/core/app.js'); ?>" type="text/javascript"></script>
<!-- END ROBUST JS-->
<!-- BEGIN PAGE LEVEL JS-->
<!--<script src="--><?php //echo plugins_url('emp/assets-profile/js/scripts/pages/dashboard-lite.js'); ?><!--" type="text/javascript"></script>-->

<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/mdb.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/popper.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/datatables.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/dataTables.buttons.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.flash.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/jszip.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/pdfmake.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/vfs_fonts.js'); ?>" type="text/javascript"></script>

<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.html5.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/buttons.print.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/mdb/persian.js'); ?>" type="text/javascript"></script>


<script src="<?php echo plugins_url('emp/assets-profile/js/persian-date/persian-date.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/persian-date/persian-datepicker.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo plugins_url('emp/assets-profile/js/scripts/digitSeprator/autonumbric.min.js'); ?>" type="text/javascript"></script>

<!-- start bootstrap notify master-->
<script src="<?php echo plugins_url('emp/assets-profile/js/bootstrap-notify-master/bootstrap-notify.min.js'); ?>" type="text/javascript"></script>
<!-- end  bootstrap notify master-->

<script type="text/javascript">
    // Basic example
    $(document).ready(function () {

        fetch_data();
        function fetch_data()
        {
            var dataTable = $('#pfb_tbl').DataTable
            (
                {
                    "aoColumns": [
                        { "sClass": "text-xs-center align-middle" },
                        {"sWidth": "30%" , "sClass": "text-xs-center align-middle" },
                        {"sWidth": "20%" , "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                        { "sClass": "text-xs-center align-middle" },
                    ],
                    "pagingType": "simple_numbers",
                    "tabIndex": 1,
                    autoPrint: false,
                    "columns": [
                        {  "name": "count_col" },
                        {  "name": "pfb_title_col" },
                        {  "name": "pfb_date_col" },
                        {  "name": "pfb_amount_col" },
                        {  "name": "pfb_description_col" },
                        {  "name": "pfb_exec_col" }
                    ],
                    'columnDefs': [
                        {
                            'targets': 3,
                            'createdCell':  function (td, cellData, rowData, row, col) {
                                $(td).attr('id', 'se_pfb_amount_show');
                            }
                        }
                    ],
                    "dom": "Bfrtip",
                    buttons: [
                        {
                            text: '<i class="icon-plus3 fa-lg "></i> &nbsp;افزودن سطر جدید',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'add_row'
                            }
                        },

                        {
                            text: '<i class="icon-printer4 fa-lg"></i> &nbsp;پرینت صورت حساب مالی',
                            className: 'btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light',
                            attr:  {
                                id: 'print_pfb'
                            }
                        }
                    ],
                    "searching": false,
                    "lengthMenu": [15],// "simple" option for 'Previous' and 'Next' buttons only
                    "language": {
                        "processing": "در حال پردازش اطلاعات ...",
                        "sInfo":"نمایش _START_ تا _END_ از مجموع _TOTAL_ مورد",
                        "emptyTable": "رکوردی یافت نشد",
                        "lengthMenu": "",
                        "zeroRecords": "",
                        "info": "",
                        "infoEmpty": "",
                        "infoFiltered": "",
                        "search": "_INPUT_",
                        "searchPlaceholder": "جستجو...",
                        "paginate": {
                            "previous": "قبلی",
                            "next": "بعدی"
                        }

                    },
                    // "processing": true,
                    "serverSide": true,
                    "ajax": "<?php echo admin_url('admin-ajax.php?action=pfinancial_bills_data&p_id=' . $p_id)?>",
                    "fnDrawCallback" : function() {
                        traverse(document.body);
                    }
                }
            );


            persian={0:'۰',1:'۱',2:'۲',3:'۳',4:'۴',5:'۵',6:'۶',7:'۷',8:'۸',9:'۹'};
            function traverse(el){
                if(el.nodeType==3){
                    var list=el.data.match(/[0-9]/g);
                    if(list!=null && list.length!=0){
                        for(var i=0;i<list.length;i++)
                            el.data=el.data.replace(list[i],persian[list[i]]);
                    }
                }
                for(var i=0;i<el.childNodes.length;i++){
                    traverse(el.childNodes[i]);
                }
            }
        }

        $(document).on('click', '#add_row', function(){
            // $('#add_row').replaceWith('<button type="button" id="add_row" class="btn purple-gradient btn-rounded  mr-1 mb-1 waves-effect waves-light" disabled="disabled"><i class="icon-plus3"></i> افزودن</button>');
            var html = '<tr class="row_insert">';
            html += '<td  id="data1"></td>';
            html += '<td contenteditable id="pfb_title_insert"></td>';
            html += '<td  >' +
                '<input type="text" id="pfb_date_insert2" class="form-control" name="pfb_date_insert2">' +
                '<input type="hidden" id="pfb_date_insert" class="form-control" name="pfb_date_insert">' +
                '</td>';
            html += '<td>' +
                '<input type="number" id="pfb_amount_insert" class="form-control" name="pfb_amount_insert">' +
                '</td>';
            html += '<td>' +
                '<textarea rows="3" id="pfb_description_insert" name="pfb_description_insert" ></textarea>' +
                '</td>';
            html += '<td><button type="submit" name="se_pfb_insert" id="se_pfb_insert" class="btn btn-sm btn-success btn-rounded  mr-1 mb-1"> <i class="icon-check2"></i>  افزودن</button><button type="btn" name="se_pfb_cancel" id="se_pfb_cancel" class="btn btn-sm btn-warning  waves-effect waves-light btn-rounded  mr-1 mb-1"> <i class="icon-cross2" ></i>  انصراف</button></td>';
            html += '</tr>';
            $('#pfb_tbl tbody').prepend(html);
        });

        function isPositiveInteger(s)
        {
            var i = +s; // convert to a number
            if (i < 0) return false; // make sure it's positive
            if (i != ~~i) return false; // make sure there's no decimal part
            return true;
        }
        $(document).on('click', '#se_pfb_insert', function(){
            var pfb_title = $('#pfb_title_insert').text();
            var pfb_date = $('#pfb_date_insert').val();
            var pfb_amount = $('#pfb_amount_insert').val();
            var pfb_description = $('#pfb_description_insert').val();
            if (pfb_title != '' && isPositiveInteger(pfb_title))
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pfb_insert_pss&p_id=' . $p_id)?>",
                    data:{
                        pfb_date:pfb_date,
                        pfb_description : pfb_description,
                        pss_id:pfb_title,
                    },
                    success:function(data)
                    {

                        if (data[0]==true)
                        {
                            $('#pfb_total').html(data[2]);
                            $('#pfb_msg').html(data[3]);
                            $.notify(
                                {
                                    message: data[1]
                                },
                                {
                                    z_index: 999999999,
                                    type: 'success',
                                    placement: {
                                        from: "top",
                                        align: "left"
                                    },
                                    showProgressbar : true,
                                    mouse_over: "pause",
                                    allow_dismiss : false
                                }
                            );

                            $('#pfb_tbl').DataTable().destroy();
                            fetch_data();
                        }
                        else
                        {
                            $.notify(
                                {
                                    message: data[1]
                                },
                                {
                                    z_index: 999999999,
                                    type: 'danger',
                                    placement: {
                                        from: "top",
                                        align: "left"
                                    },
                                    showProgressbar : true,
                                    mouse_over: "pause",
                                    allow_dismiss : false
                                }
                            );
                        }

                    }
                });

            }
            else
            {
                if(pfb_title != '' && pfb_date != '' && pfb_amount != '' )
                {
                    $.ajax({
                        url:"<?php echo admin_url('admin-ajax.php?action=pfb_insert&p_id=' . $p_id)?>",
                        data:{
                            pfb_title:pfb_title,
                            pfb_date:pfb_date,
                            pfb_amount :pfb_amount,
                            pfb_description : pfb_description,
                        },
                        success:function(data)
                        {

                            if (data[0]==true)
                            {
                                $('#pfb_total').html(data[2]);
                                $('#pfb_msg').html(data[3]);
                                $.notify(
                                    {
                                        message: data[1]
                                    },
                                    {
                                        z_index: 999999999,
                                        type: 'success',
                                        placement: {
                                            from: "top",
                                            align: "left"
                                        },
                                        showProgressbar : true,
                                        mouse_over: "pause",
                                        allow_dismiss : false
                                    }
                                );

                                $('#pfb_tbl').DataTable().destroy();
                                fetch_data();
                            }
                            else
                            {
                                $.notify(
                                    {
                                        message: data[1]
                                    },
                                    {
                                        z_index: 999999999,
                                        type: 'danger',
                                        placement: {
                                            from: "top",
                                            align: "left"
                                        },
                                        showProgressbar : true,
                                        mouse_over: "pause",
                                        allow_dismiss : false
                                    }
                                );
                            }

                        }
                    });

                }
                else
                {
                    alert("لطفا تمامی فیلد ها را وارد نمایید!");
                }
            }

        });


        $(document).on('click', '#se_pfb_delete', function(){
            var id = $(this).data("id");
            if(confirm("مطمئن هستید?"))
            {
                $.ajax({
                    url:"<?php echo admin_url('admin-ajax.php?action=pfb_delete')?>",
                    data:{
                        id:id,
                        pid:<?php echo $p_id?>
                    },
                    success:function(data)
                    {
                        if (data[0]==true)
                        {
                            $('#pfb_total').html(data[2]);
                            $('#pfb_msg').html(data[3]);
                            $.notify(
                                {
                                    message: data[1]
                                },
                                {
                                    z_index: 999999999,
                                    type: 'success',
                                    placement: {
                                        from: "top",
                                        align: "left"
                                    },
                                    showProgressbar : true,
                                    mouse_over: "pause",
                                    allow_dismiss : false
                                }
                            );

                            $('#pfb_tbl').DataTable().destroy();
                            fetch_data();
                        }
                        else
                        {
                            $.notify(
                                {
                                    message: data[1]
                                },
                                {
                                    z_index: 999999999,
                                    type: 'danger',
                                    placement: {
                                        from: "top",
                                        align: "left"
                                    },
                                    showProgressbar : true,
                                    mouse_over: "pause",
                                    allow_dismiss : false
                                }
                            );
                        }

                    }

                });
                setInterval(function(){
                    $('#alert_message').html('');
                }, 5000);
            }
        });

        $('body').on('click',"#se_pfb_cancel", function(){
            $(this).closest("tr").remove();
        });



        $('body').on('focus',"#pfb_date_insert2", function(){
            $(this).pDatepicker({

                "autoClose": true,
                "initialValue": false,
                "altField": "#pfb_date_insert",
                "format" : "YYYY / MM / DD ",
                "altFieldFormatter" :function (unixDate) {
                    var self = this;
                    var pd = new persianDate(unixDate).toCalendar('gregorian').format('X');
                    return pd;
                }
            });
        });

        $(document).on('load', function(){
            $(this).traverse(document.body);
        });

        persian={0:'۰',1:'۱',2:'۲',3:'۳',4:'۴',5:'۵',6:'۶',7:'۷',8:'۸',9:'۹'};
        function traverse(el){
            if(el.nodeType==3){
                var list=el.data.match(/[0-9]/g);
                if(list!=null && list.length!=0){
                    for(var i=0;i<list.length;i++)
                        el.data=el.data.replace(list[i],persian[list[i]]);
                }
            }
            for(var i=0;i<el.childNodes.length;i++){
                traverse(el.childNodes[i]);
            }
        }



        $(document).on('click', '#print_pfb', function(){
            window.open(
                '<?php echo home_url('se_admin_print/?p_id='.$p_id.'&target_tbl=pfb')?>',
                '_blank' // <- This is what makes it open in a new window.
            );
        });
    });





</script>
<!-- END PAGE LEVEL JS-->

</body>

</html>

